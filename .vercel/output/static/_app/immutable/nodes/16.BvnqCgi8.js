import{s as Z,n as R,r as $,o as ee}from"../chunks/DUJQqtHE.js";import{S as te,i as se,d as A,u as H,s as J,a as Q,b as n,v as F,o as a,c as g,e as k,p as N,g as x,f as X,h as m,j as S,t as Y}from"../chunks/CBbGAyDJ.js";import{s as P}from"../chunks/BxpIoVra.js";function G(f){let e,s;return{c(){e=m("div"),s=Y(f[2]),this.h()},l(d){e=g(d,"DIV",{class:!0});var c=k(e);s=X(c,f[2]),c.forEach(A),this.h()},h(){a(e,"class","mb-4 text-sm text-red-600")},m(d,c){Q(d,e,c),n(e,s)},p(d,c){c&4&&J(s,d[2])},d(d){d&&A(e)}}}function ne(f){let e,s,d="Entrar",c,D,l,E,_,T="E-mail",C,o,p,i,b,t="Senha",w,v,O,y,M=f[3]?"Entrando...":"Entrar",q,U,I,j='<a href="/esqueci-senha" class="text-sky-600 hover:underline">Esqueci minha senha</a> <span class="mx-2">·</span> <a href="/cadastro" class="text-sky-600 hover:underline">Criar conta</a>',W,z,r=f[2]&&G(f);return{c(){e=m("div"),s=m("h1"),s.textContent=d,c=S(),r&&r.c(),D=S(),l=m("form"),E=m("div"),_=m("label"),_.textContent=T,C=S(),o=m("input"),p=S(),i=m("div"),b=m("label"),b.textContent=t,w=S(),v=m("input"),O=S(),y=m("button"),q=Y(M),U=S(),I=m("div"),I.innerHTML=j,this.h()},l(h){e=g(h,"DIV",{class:!0});var u=k(e);s=g(u,"H1",{class:!0,"data-svelte-h":!0}),N(s)!=="svelte-6lfyta"&&(s.textContent=d),c=x(u),r&&r.l(u),D=x(u),l=g(u,"FORM",{class:!0});var L=k(l);E=g(L,"DIV",{});var B=k(E);_=g(B,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),N(_)!=="svelte-1c0xgzu"&&(_.textContent=T),C=x(B),o=g(B,"INPUT",{id:!0,type:!0,class:!0}),B.forEach(A),p=x(L),i=g(L,"DIV",{});var V=k(i);b=g(V,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),N(b)!=="svelte-1uuppix"&&(b.textContent=t),w=x(V),v=g(V,"INPUT",{id:!0,type:!0,class:!0}),V.forEach(A),O=x(L),y=g(L,"BUTTON",{type:!0,class:!0});var K=k(y);q=X(K,M),K.forEach(A),L.forEach(A),U=x(u),I=g(u,"DIV",{class:!0,"data-svelte-h":!0}),N(I)!=="svelte-3yl7w7"&&(I.innerHTML=j),u.forEach(A),this.h()},h(){a(s,"class","text-xl font-semibold mb-4"),a(_,"for","login-email"),a(_,"class","block text-sm mb-1"),a(o,"id","login-email"),a(o,"type","email"),a(o,"class","input-form"),o.required=!0,a(b,"for","login-password"),a(b,"class","block text-sm mb-1"),a(v,"id","login-password"),a(v,"type","password"),a(v,"class","input-form"),v.required=!0,a(y,"type","submit"),y.disabled=f[3],a(y,"class","btn-primary w-full"),a(l,"class","space-y-4"),a(I,"class","text-sm mt-4"),a(e,"class","max-w-md mx-auto bg-white dark:bg-slate-800 rounded-lg shadow p-6")},m(h,u){Q(h,e,u),n(e,s),n(e,c),r&&r.m(e,null),n(e,D),n(e,l),n(l,E),n(E,_),n(E,C),n(E,o),H(o,f[0]),n(l,p),n(l,i),n(i,b),n(i,w),n(i,v),H(v,f[1]),n(l,O),n(l,y),n(y,q),n(e,U),n(e,I),W||(z=[F(o,"input",f[5]),F(v,"input",f[6]),F(l,"submit",f[4])],W=!0)},p(h,[u]){h[2]?r?r.p(h,u):(r=G(h),r.c(),r.m(e,D)):r&&(r.d(1),r=null),u&1&&o.value!==h[0]&&H(o,h[0]),u&2&&v.value!==h[1]&&H(v,h[1]),u&8&&M!==(M=h[3]?"Entrando...":"Entrar")&&J(q,M),u&8&&(y.disabled=h[3])},i:R,o:R,d(h){h&&A(e),r&&r.d(),W=!1,$(z)}}}function oe(f,e,s){let d="",c="",D="",l=!1;ee(async()=>{var C,o;if(P){console.groupCollapsed("[AuthDebug] /login onMount");try{const{data:p,error:i}=await P.auth.getSession();i&&console.warn("[AuthDebug] getSession error (login):",(i==null?void 0:i.message)||i),console.log("[AuthDebug] getSession (login)",{hasSession:!!(p!=null&&p.session),userId:((o=(C=p==null?void 0:p.session)==null?void 0:C.user)==null?void 0:o.id)||null}),p.session&&(console.log("[AuthDebug] already logged in -> redirect /app"),window.location.href="/app")}finally{console.groupEnd()}}});async function E(C){var o,p,i,b;if(C.preventDefault(),!l){s(3,l=!0),s(2,D="");try{if(!P)throw new Error("Configuração do Supabase ausente.");console.groupCollapsed("[AuthDebug] handleLogin"),console.time("[AuthDebug] supabase.signInWithPassword");const{data:t,error:w}=await P.auth.signInWithPassword({email:d,password:c});if(console.timeEnd("[AuthDebug] supabase.signInWithPassword"),w)throw console.warn("[AuthDebug] login error:",(w==null?void 0:w.message)||w),w;t!=null&&t.session&&(console.log("[AuthDebug] login OK -> has session, redirect /app",{userId:((o=t.session.user)==null?void 0:o.id)||null}),window.location.href="/app")}catch(t){console.error("[AuthDebug] login exception:",(t==null?void 0:t.message)||t),s(2,D=(t==null?void 0:t.message)||"Falha ao entrar.")}finally{try{const{data:t}=await P.auth.getSession();console.log("[AuthDebug] post-login getSession",{hasSession:!!(t!=null&&t.session),userId:((i=(p=t==null?void 0:t.session)==null?void 0:p.user)==null?void 0:i.id)||null})}catch{}(b=console.groupEnd)==null||b.call(console),s(3,l=!1)}}}function _(){d=this.value,s(0,d)}function T(){c=this.value,s(1,c)}return[d,c,D,l,E,_,T]}class re extends te{constructor(e){super(),se(this,e,oe,ne,Z,{})}}export{re as component};
