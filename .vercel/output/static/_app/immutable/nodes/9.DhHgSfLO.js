import{s as de,n as O,r as re,o as ce}from"../chunks/DUJQqtHE.js";import{S as fe,i as _e,d as i,u as R,a as S,b as d,v as U,o as m,c as g,p as H,g as L,e as I,n as $,h as k,j as V,s as M,f as B,t as z,r as oe}from"../chunks/CBbGAyDJ.js";import{e as ee,u as he,d as pe}from"../chunks/BMMEC0mH.js";import{s as G}from"../chunks/BxpIoVra.js";function te(c,e,s){const t=c.slice();return t[14]=e[s],t[15]=e,t[16]=s,t}function se(c){let e,s;return{c(){e=k("div"),s=z(c[3]),this.h()},l(t){e=g(t,"DIV",{class:!0});var l=I(e);s=B(l,c[3]),l.forEach(i),this.h()},h(){m(e,"class","fixed top-4 right-4 bg-emerald-600 text-white px-3 py-2 rounded shadow")},m(t,l){S(t,e,l),d(e,s)},p(t,l){l&8&&M(s,t[3])},d(t){t&&i(e)}}}function me(c){let e,s,t,l='<tr class="text-left border-b border-slate-200 dark:border-slate-700"><th class="py-2 pr-4">Produto</th> <th class="py-2 pr-4 w-40">Estoque Atual</th> <th class="py-2 pr-4 w-32"></th> <th class="py-2 pr-4 w-40"></th></tr>',v,w,u=[],p=new Map,y=ee(c[4]());const T=o=>o[14].id;for(let o=0;o<y.length;o+=1){let h=te(c,y,o),f=T(h);p.set(f,u[o]=ae(f,h))}return{c(){e=k("div"),s=k("table"),t=k("thead"),t.innerHTML=l,v=V(),w=k("tbody");for(let o=0;o<u.length;o+=1)u[o].c();this.h()},l(o){e=g(o,"DIV",{class:!0});var h=I(e);s=g(h,"TABLE",{class:!0});var f=I(s);t=g(f,"THEAD",{"data-svelte-h":!0}),H(t)!=="svelte-jiwa7m"&&(t.innerHTML=l),v=L(f),w=g(f,"TBODY",{});var b=I(w);for(let D=0;D<u.length;D+=1)u[D].l(b);b.forEach(i),f.forEach(i),h.forEach(i),this.h()},h(){m(s,"class","min-w-[520px] w-full text-sm"),m(e,"class","overflow-x-auto")},m(o,h){S(o,e,h),d(e,s),d(s,t),d(s,v),d(s,w);for(let f=0;f<u.length;f+=1)u[f]&&u[f].m(w,null)},p(o,h){h&80&&(y=ee(o[4]()),u=he(u,h,T,1,o,y,p,w,pe,ae,null,te))},d(o){o&&i(e);for(let h=0;h<u.length;h+=1)u[h].d()}}}function ve(c){let e,s="Nenhum produto com controle de estoque encontrado.";return{c(){e=k("p"),e.textContent=s,this.h()},l(t){e=g(t,"P",{class:!0,"data-svelte-h":!0}),H(e)!=="svelte-ovbdzv"&&(e.textContent=s),this.h()},h(){m(e,"class","text-slate-500")},m(t,l){S(t,e,l)},p:O,d(t){t&&i(e)}}}function be(c){let e,s;return{c(){e=k("p"),s=z(c[1]),this.h()},l(t){e=g(t,"P",{class:!0});var l=I(e);s=B(l,c[1]),l.forEach(i),this.h()},h(){m(e,"class","text-red-500")},m(t,l){S(t,e,l),d(e,s)},p(t,l){l&2&&M(s,t[1])},d(t){t&&i(e)}}}function ge(c){let e,s="Carregando estoque...";return{c(){e=k("p"),e.textContent=s},l(t){e=g(t,"P",{"data-svelte-h":!0}),H(e)!=="svelte-5vzjzq"&&(e.textContent=s)},m(t,l){S(t,e,l)},p:O,d(t){t&&i(e)}}}function le(c){let e,s=c[14]._msg+"",t;return{c(){e=k("span"),t=z(s),this.h()},l(l){e=g(l,"SPAN",{class:!0});var v=I(e);t=B(v,s),v.forEach(i),this.h()},h(){m(e,"class","text-slate-500")},m(l,v){S(l,e,v),d(e,t)},p(l,v){v&16&&s!==(s=l[14]._msg+"")&&M(t,s)},d(l){l&&i(e)}}}function ae(c,e){let s,t,l,v=e[14].nome+"",w,u,p,y,T=e[14].id+"",o,h,f,b,D,x,r,n=e[14]._saving?"Salvando...":"Salvar",q,P,N,a,_,Y,J;function ne(){e[8].call(b,e[15],e[16])}function ie(...A){return e[9](e[14],...A)}function ue(){return e[10](e[14])}let C=e[14]._msg&&le(e);return{key:c,first:null,c(){s=k("tr"),t=k("td"),l=k("div"),w=z(v),u=V(),p=k("div"),y=z("ID: "),o=z(T),h=V(),f=k("td"),b=k("input"),D=V(),x=k("td"),r=k("button"),q=z(n),N=V(),a=k("td"),C&&C.c(),_=V(),this.h()},l(A){s=g(A,"TR",{class:!0});var E=I(s);t=g(E,"TD",{class:!0});var j=I(t);l=g(j,"DIV",{class:!0});var K=I(l);w=B(K,v),K.forEach(i),u=L(j),p=g(j,"DIV",{class:!0});var F=I(p);y=B(F,"ID: "),o=B(F,T),F.forEach(i),j.forEach(i),h=L(E),f=g(E,"TD",{class:!0});var Q=I(f);b=g(Q,"INPUT",{type:!0,min:!0,step:!0,class:!0}),Q.forEach(i),D=L(E),x=g(E,"TD",{class:!0});var W=I(x);r=g(W,"BUTTON",{class:!0});var X=I(r);q=B(X,n),X.forEach(i),W.forEach(i),N=L(E),a=g(E,"TD",{class:!0});var Z=I(a);C&&C.l(Z),Z.forEach(i),_=L(E),E.forEach(i),this.h()},h(){m(l,"class","font-medium"),m(p,"class","text-xs text-slate-500"),m(t,"class","py-2 pr-4"),m(b,"type","number"),m(b,"min","0"),m(b,"step","1"),m(b,"class","w-28 rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-2 py-1"),m(f,"class","py-2 pr-4"),m(r,"class","px-3 py-1.5 rounded-md bg-blue-600 text-white disabled:bg-slate-400"),r.disabled=P=e[14]._saving,m(x,"class","py-2 pr-4"),m(a,"class","py-2 pr-4 text-xs"),m(s,"class","border-b border-slate-100 dark:border-slate-800"),this.first=s},m(A,E){S(A,s,E),d(s,t),d(t,l),d(l,w),d(t,u),d(t,p),d(p,y),d(p,o),d(s,h),d(s,f),d(f,b),R(b,e[14]._tmpEstoque),d(s,D),d(s,x),d(x,r),d(r,q),d(s,N),d(s,a),C&&C.m(a,null),d(s,_),Y||(J=[U(b,"input",ne),U(b,"keydown",ie),U(r,"click",ue)],Y=!0)},p(A,E){e=A,E&16&&v!==(v=e[14].nome+"")&&M(w,v),E&16&&T!==(T=e[14].id+"")&&M(o,T),E&16&&oe(b.value)!==e[14]._tmpEstoque&&R(b,e[14]._tmpEstoque),E&16&&n!==(n=e[14]._saving?"Salvando...":"Salvar")&&M(q,n),E&16&&P!==(P=e[14]._saving)&&(r.disabled=P),e[14]._msg?C?C.p(e,E):(C=le(e),C.c(),C.m(a,null)):C&&(C.d(1),C=null)},d(A){A&&i(s),C&&C.d(),Y=!1,re(J)}}}function ke(c){let e,s="Estoque",t,l,v="Edite as quantidades de produtos com controle de estoque habilitado.",w,u,p,y,T,o,h="Atualizar",f,b,D,x,r,n=c[3]&&se(c);function q(a,_){return _&16&&(b=null),a[0]?ge:a[1]?be:(b==null&&(b=a[4]().length===0),b?ve:me)}let P=q(c,-1),N=P(c);return{c(){e=k("h1"),e.textContent=s,t=V(),l=k("p"),l.textContent=v,w=V(),n&&n.c(),u=V(),p=k("div"),y=k("input"),T=V(),o=k("button"),o.textContent=h,f=V(),N.c(),D=$(),this.h()},l(a){e=g(a,"H1",{class:!0,"data-svelte-h":!0}),H(e)!=="svelte-198lalm"&&(e.textContent=s),t=L(a),l=g(a,"P",{class:!0,"data-svelte-h":!0}),H(l)!=="svelte-2su0l7"&&(l.textContent=v),w=L(a),n&&n.l(a),u=L(a),p=g(a,"DIV",{class:!0});var _=I(p);y=g(_,"INPUT",{placeholder:!0,class:!0}),T=L(_),o=g(_,"BUTTON",{class:!0,"data-svelte-h":!0}),H(o)!=="svelte-1ruqetr"&&(o.textContent=h),_.forEach(i),f=L(a),N.l(a),D=$(),this.h()},h(){m(e,"class","text-2xl font-semibold mb-4"),m(l,"class","text-slate-600 dark:text-slate-300 mb-3"),m(y,"placeholder","Buscar produto..."),m(y,"class","w-full sm:w-80 rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2"),m(o,"class","px-3 py-2 rounded-md border border-slate-300 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800"),m(p,"class","flex items-center gap-2 mb-4")},m(a,_){S(a,e,_),S(a,t,_),S(a,l,_),S(a,w,_),n&&n.m(a,_),S(a,u,_),S(a,p,_),d(p,y),R(y,c[2]),d(p,T),d(p,o),S(a,f,_),N.m(a,_),S(a,D,_),x||(r=[U(y,"input",c[7]),U(o,"click",c[5])],x=!0)},p(a,[_]){a[3]?n?n.p(a,_):(n=se(a),n.c(),n.m(u.parentNode,u)):n&&(n.d(1),n=null),_&4&&y.value!==a[2]&&R(y,a[2]),P===(P=q(a,_))&&N?N.p(a,_):(N.d(1),N=P(a),N&&(N.c(),N.m(D.parentNode,D)))},i:O,o:O,d(a){a&&(i(e),i(t),i(l),i(w),i(u),i(p),i(f),i(D)),n&&n.d(a),N.d(a),x=!1,re(r)}}}function ye(c,e,s){let t=!0,l="",v=null,w=[],u="",p="",y=null;async function T(){s(1,l=""),s(0,t=!0);try{const{data:{session:r}}=await G.auth.getSession();if(!r){window.location.href="/login";return}v=r.user.id;const{data:n,error:q}=await G.from("produtos").select("id, nome, estoque_atual, controlar_estoque").eq("id_usuario",v).eq("controlar_estoque",!0).order("nome",{ascending:!0});if(q)throw q;w=(n||[]).map(P=>({...P,_tmpEstoque:P.estoque_atual,_saving:!1,_msg:""}))}catch(r){s(1,l=(r==null?void 0:r.message)||String(r))}finally{s(0,t=!1)}}ce(T);function o(){const r=(u||"").toLowerCase().trim();return r?w.filter(n=>String(n.nome||"").toLowerCase().includes(r)):w}async function h(r){if(!r||r._saving)return;const n=Number(r._tmpEstoque);if(Number.isNaN(n)||n<0){r._msg="Valor invÃ¡lido";return}r._saving=!0,r._msg="";try{const{error:q}=await G.from("produtos").update({estoque_atual:n}).eq("id",r.id).eq("id_usuario",v);if(q)throw q;r.estoque_atual=n,r._msg="Salvo",s(3,p="Estoque salvo com sucesso"),clearTimeout(y),y=setTimeout(()=>{s(3,p="")},2e3),setTimeout(()=>{r._msg=""},1200)}catch(q){r._msg=(q==null?void 0:q.message)||"Erro ao salvar"}finally{r._saving=!1}}function f(){u=this.value,s(2,u)}function b(r,n){r[n]._tmpEstoque=oe(this.value),s(4,o)}return[t,l,u,p,o,T,h,f,b,(r,n)=>{n.key==="Enter"&&h(r)},r=>h(r)]}class Te extends fe{constructor(e){super(),_e(this,e,ye,ke,de,{})}}export{Te as component};
