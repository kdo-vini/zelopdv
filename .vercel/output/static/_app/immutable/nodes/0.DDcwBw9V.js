import{s as z,a as G,u as K,g as Y,b as J,c as Q,o as X,n as ee}from"../chunks/DUJQqtHE.js";import{S as te,i as se,d as c,k as ae,l as le,a as P,b as _,o as r,c as w,e as L,p as j,g as B,f as V,h as A,j as F,t as q}from"../chunks/CBbGAyDJ.js";import{s as R,h as oe}from"../chunks/BxpIoVra.js";import{p as re}from"../chunks/D5Jx8Owt.js";function ne(x){let e,m="Entrar",d,l,g="Criar conta";return{c(){e=A("a"),e.textContent=m,d=F(),l=A("a"),l.textContent=g,this.h()},l(t){e=w(t,"A",{href:!0,class:!0,"data-svelte-h":!0}),j(e)!=="svelte-1dolpip"&&(e.textContent=m),d=B(t),l=w(t,"A",{href:!0,class:!0,"data-svelte-h":!0}),j(l)!=="svelte-1rgfcx0"&&(l.textContent=g),this.h()},h(){r(e,"href","/login"),r(e,"class","text-sm font-medium text-sky-600 hover:text-sky-800 dark:text-sky-400 dark:hover:text-sky-300 transition-colors"),r(l,"href","/cadastro"),r(l,"class","ml-2 inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-sky-600 border border-transparent rounded-md shadow-sm hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 transition-colors")},m(t,n){P(t,e,n),P(t,d,n),P(t,l,n)},p:ee,d(t){t&&(c(e),c(d),c(l))}}}function ie(x){let e,m,d,l,g,t,n,h,i,S,v,k,u,E,C;return{c(){e=A("a"),m=q("Frente de Caixa"),l=F(),g=A("a"),t=q("Admin"),h=F(),i=A("a"),S=q("Relatórios"),k=F(),u=A("a"),E=q("Perfil"),this.h()},l(a){e=w(a,"A",{href:!0,class:!0});var s=L(e);m=V(s,"Frente de Caixa"),s.forEach(c),l=B(a),g=w(a,"A",{href:!0,class:!0});var f=L(g);t=V(f,"Admin"),f.forEach(c),h=B(a),i=w(a,"A",{href:!0,class:!0});var I=L(i);S=V(I,"Relatórios"),I.forEach(c),k=B(a),u=w(a,"A",{href:!0,class:!0});var b=L(u);E=V(b,"Perfil"),b.forEach(c),this.h()},h(){r(e,"href","/app"),r(e,"class",d=T+" "+(x[1].url.pathname.startsWith("/app")?N:W)),r(g,"href","/admin"),r(g,"class",n=T+" "+(x[1].url.pathname.startsWith("/admin")?N:W)),r(i,"href","/relatorios"),r(i,"class",v=T+" "+(x[1].url.pathname.startsWith("/relatorios")?N:W)),r(u,"href","/perfil"),r(u,"class",C="ml-4 "+T+" "+(x[1].url.pathname.startsWith("/perfil")?N:W)+" !px-3 !py-1.5")},m(a,s){P(a,e,s),_(e,m),P(a,l,s),P(a,g,s),_(g,t),P(a,h,s),P(a,i,s),_(i,S),P(a,k,s),P(a,u,s),_(u,E)},p(a,s){s&2&&d!==(d=T+" "+(a[1].url.pathname.startsWith("/app")?N:W))&&r(e,"class",d),s&2&&n!==(n=T+" "+(a[1].url.pathname.startsWith("/admin")?N:W))&&r(g,"class",n),s&2&&v!==(v=T+" "+(a[1].url.pathname.startsWith("/relatorios")?N:W))&&r(i,"class",v),s&2&&C!==(C="ml-4 "+T+" "+(a[1].url.pathname.startsWith("/perfil")?N:W)+" !px-3 !py-1.5")&&r(u,"class",C)},d(a){a&&(c(e),c(l),c(g),c(h),c(i),c(k),c(u))}}}function ue(x){let e,m,d,l,g='<span class="text-xl sm:text-2xl font-extrabold tracking-tight leading-none"><span class="text-slate-900 dark:text-white">Zelo</span> <span class="ml-1 align-[2px] inline-flex items-center rounded-md border px-2 py-0.5 text-[10px] sm:text-[11px] font-semibold uppercase tracking-wider border-sky-200 text-sky-700 bg-sky-50 dark:border-sky-500/30 dark:text-sky-300 dark:bg-sky-500/10">PDV</span></span> <span class="sr-only">Zelo PDV</span>',t,n,h,i,S,v,k,u,E=new Date().getFullYear()+"",C,a,s;function f(o,D){return o[0]?ie:ne}let I=f(x),b=I(x);const y=x[3].default,p=G(y,x,x[2],null);return{c(){e=A("div"),m=A("header"),d=A("div"),l=A("a"),l.innerHTML=g,t=F(),n=A("nav"),b.c(),h=F(),i=A("main"),p&&p.c(),S=F(),v=A("footer"),k=A("div"),u=q("© "),C=q(E),a=q(" Zelo PDV · Desenvolvido por Téchne IA"),this.h()},l(o){e=w(o,"DIV",{class:!0});var D=L(e);m=w(D,"HEADER",{class:!0});var H=L(m);d=w(H,"DIV",{class:!0});var M=L(d);l=w(M,"A",{href:!0,class:!0,"data-svelte-h":!0}),j(l)!=="svelte-dxx3qx"&&(l.innerHTML=g),t=B(M),n=w(M,"NAV",{class:!0});var Z=L(n);b.l(Z),Z.forEach(c),M.forEach(c),H.forEach(c),h=B(D),i=w(D,"MAIN",{class:!0});var $=L(i);p&&p.l($),$.forEach(c),S=B(D),v=w(D,"FOOTER",{class:!0});var U=L(v);k=w(U,"DIV",{class:!0});var O=L(k);u=V(O,"© "),C=V(O,E),a=V(O," Zelo PDV · Desenvolvido por Téchne IA"),O.forEach(c),U.forEach(c),D.forEach(c),this.h()},h(){r(l,"href","/"),r(l,"class","flex items-center gap-2"),r(n,"class","flex gap-4 text-sm items-center"),r(d,"class","max-w-6xl mx-auto px-4 py-3 flex items-center justify-between"),r(m,"class","border-b border-slate-200/80 dark:border-slate-700/80 bg-white dark:bg-slate-900 backdrop-blur sticky top-0 z-50"),r(i,"class","max-w-6xl mx-auto px-4 py-6"),r(k,"class","max-w-6xl mx-auto px-4"),r(v,"class","border-t border-slate-200/80 dark:border-slate-700/80 py-6 text-center text-xs text-slate-500 dark:text-slate-400 bg-white dark:bg-slate-900"),r(e,"class","min-h-screen bg-slate-50 text-slate-900 dark:bg-slate-900 dark:text-slate-50")},m(o,D){P(o,e,D),_(e,m),_(m,d),_(d,l),_(d,t),_(d,n),b.m(n,null),_(e,h),_(e,i),p&&p.m(i,null),_(e,S),_(e,v),_(v,k),_(k,u),_(k,C),_(k,a),s=!0},p(o,[D]){I===(I=f(o))&&b?b.p(o,D):(b.d(1),b=I(o),b&&(b.c(),b.m(n,null))),p&&p.p&&(!s||D&4)&&K(p,y,o,o[2],s?J(y,o[2],D,null):Y(o[2]),null)},i(o){s||(le(p,o),s=!0)},o(o){ae(p,o),s=!1},d(o){o&&c(e),b.d(),p&&p.d(o)}}}const T="px-3 py-1.5 rounded-md text-sm font-medium transition-colors duration-150",W="text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800",N="font-semibold text-sky-600 dark:text-sky-400 bg-sky-50 dark:bg-sky-900/50";function ce(x,e,m){let d;Q(x,re,n=>m(1,d=n));let{$$slots:l={},$$scope:g}=e,t=null;return X(async()=>{var C,a;if(!R)return;const n=["/","/login","/cadastro","/esqueci-senha","/landing","/assinatura","/perfil","/perfil.html","/painel.html"],h=window.location.pathname;console.groupCollapsed("[AuthDebug] +layout onMount"),console.log("path =",h),console.log("hasSupabaseConfig =",oe),console.log("supabase exists =",!!R);let i=!1,S=!1;const v=async()=>{var b;if(i||!S)return;let s=!1,f=!1;if((b=t==null?void 0:t.user)!=null&&b.id)try{let{data:y}=await R.from("subscriptions").select("status, current_period_end").eq("user_id",t.user.id).maybeSingle();if(!y){const{data:o}=await R.from("subscriptions").select("id, status, user_id, user_email").eq("user_email",t.user.email).maybeSingle();o&&(y=o,o.user_id||await R.from("subscriptions").update({user_id:t.user.id}).eq("id",o.id))}s=y&&(y.status==="active"||y.status==="trialing");let{data:p}=await R.from("empresa_perfil").select("nome_exibicao, documento, contato, largura_bobina").eq("user_id",t.user.id).maybeSingle();f=!!(p&&p.nome_exibicao&&p.documento&&p.contato&&(p.largura_bobina==="58mm"||p.largura_bobina==="80mm"))}catch{}if(t&&!f&&h!=="/perfil.html"){console.log("[AuthDebug] decision: force complete profile -> /perfil.html");const y=new URLSearchParams({msg:"complete"});window.location.href=`/perfil?${y.toString()}`,i=!0;return}if(!t&&!n.includes(h)){console.log("[AuthDebug] decision: redirect to /login (protected path + no session)"),window.location.href="/login",i=!0;return}if(t&&n.includes(h)){console.log("[AuthDebug] decision: user is logged on a public path"),h==="/"||h==="/assinatura"||h==="/perfil"||h==="/perfil.html"?console.log("[AuthDebug] stay on public path",h):(console.log("[AuthDebug] redirect to /app"),window.location.href="/app",i=!0);return}if(t&&["/app","/admin","/relatorios"].some(y=>h.startsWith(y))){if(!f){console.log("[AuthDebug] decision: incomplete profile -> redirect /perfil");const y=new URLSearchParams({msg:"complete"});window.location.href=`/perfil?${y.toString()}`,i=!0;return}if(!s){console.log("[AuthDebug] decision: no active subscription -> redirect /assinatura"),window.location.href="/assinatura",i=!0;return}}};R.auth.onAuthStateChange((s,f)=>{var I;console.log("[AuthDebug] onAuthStateChange",{event:s,hasSession:!!f,userId:((I=f==null?void 0:f.user)==null?void 0:I.id)||null}),m(0,t=f),["INITIAL_SESSION","SIGNED_IN","TOKEN_REFRESHED"].includes(s)&&(S=!0,v())});const k=(s=3e3)=>Promise.race([R.auth.getSession(),new Promise(f=>setTimeout(()=>f({data:{session:null},error:null}),s))]);console.time("[AuthDebug] getSession (layout)");const{data:u,error:E}=await k(4e3);console.timeEnd("[AuthDebug] getSession (layout)"),E&&console.warn("[AuthDebug] getSession error:",(E==null?void 0:E.message)||E),console.log("[AuthDebug] getSession",{hasSession:!!(u!=null&&u.session),userId:((a=(C=u==null?void 0:u.session)==null?void 0:C.user)==null?void 0:a.id)||null}),u!=null&&u.session&&m(0,t=u.session),S=!0,v(),setTimeout(()=>{!i&&!S&&(console.log("[AuthDebug] fallback: auth not ready after 1s, proceeding with current session state"),S=!0,v())},1e3);try{const s=Object.keys(localStorage).filter(f=>f.includes("sb-")||f.toLowerCase().includes("supabase"));console.log("[AuthDebug] localStorage keys (sb-/supabase):",s)}catch{}console.groupEnd()}),x.$$set=n=>{"$$scope"in n&&m(2,g=n.$$scope)},[t,d,g,l]}class me extends te{constructor(e){super(),se(this,e,ce,ue,z,{})}}export{me as component};
