import{s as Ge,n as Ht,o as Ue,r as Ae}from"../chunks/DUJQqtHE.js";import{S as Be,i as Me,d as c,a as J,o as l,c as s,p as R,g,n as Oe,h as i,j as C,s as w,b as t,e as h,f as x,t as p,r as je,u as Te,v as Le}from"../chunks/CBbGAyDJ.js";import{s as Nt}from"../chunks/BxpIoVra.js";function Pe(n){let e,d;return{c(){e=i("div"),d=p(n[6]),this.h()},l(a){e=s(a,"DIV",{class:!0});var u=h(e);d=x(u,n[6]),u.forEach(c),this.h()},h(){l(e,"class","mb-4 text-sm text-red-600")},m(a,u){J(a,e,u),t(e,d)},p(a,u){u&64&&w(d,a[6])},d(a){a&&c(e)}}}function He(n){let e,d,a,u,F="Data de abertura",m,I,V=new Date(n[0].data_abertura).toLocaleString()+"",N,r,f,E,it="Troco inicial",j,L,ut,o=Number(n[0].valor_inicial||0).toFixed(2)+"",v,K,D,y,S,De="Dinheiro",zt,Q,Jt,vt=Number(n[3].dinheiro).toFixed(2)+"",Dt,Kt,q,W,Ie="Cartão",Qt,X,Wt,ft=Number(n[4]).toFixed(2)+"",It,Xt,O,Yt,_t=Number(n[3].cartao_debito).toFixed(2)+"",Vt,Zt,mt=Number(n[3].cartao_credito).toFixed(2)+"",Et,ht=n[3].cartao_legacy>0?` · Outros R$ ${Number(n[3].cartao_legacy).toFixed(2)}`:"",Ft,$t,G,Y,Ve="Pix",te,Z,ee,bt=Number(n[3].pix).toFixed(2)+"",wt,ae,U,$,Ee="Total",re,tt,le,xt=Number(n[9]).toFixed(2)+"",Rt,oe,T,et,A,Fe="Valor contado na gaveta",se,k,ie,at,rt,we="Esperado na gaveta",de,lt,ne,pt=Number(n[2]).toFixed(2)+"",kt,ce,ot,st,Re="Diferença",ue,B,ve,gt=Number(n[8]).toFixed(2)+"",yt,St,fe,M,H,ke="Voltar ao PDV",_e,P,Ct=n[7]?"Fechando...":"Fechar Caixa",qt,me,ye;return{c(){e=i("section"),d=i("div"),a=i("div"),u=i("div"),u.textContent=F,m=C(),I=i("div"),N=p(V),r=C(),f=i("div"),E=i("div"),E.textContent=it,j=C(),L=i("div"),ut=p("R$ "),v=p(o),K=C(),D=i("div"),y=i("div"),S=i("div"),S.textContent=De,zt=C(),Q=i("div"),Jt=p("R$ "),Dt=p(vt),Kt=C(),q=i("div"),W=i("div"),W.textContent=Ie,Qt=C(),X=i("div"),Wt=p("R$ "),It=p(ft),Xt=C(),O=i("div"),Yt=p("Débito R$ "),Vt=p(_t),Zt=p(" · Crédito R$ "),Et=p(mt),Ft=p(ht),$t=C(),G=i("div"),Y=i("div"),Y.textContent=Ve,te=C(),Z=i("div"),ee=p("R$ "),wt=p(bt),ae=C(),U=i("div"),$=i("div"),$.textContent=Ee,re=C(),tt=i("div"),le=p("R$ "),Rt=p(xt),oe=C(),T=i("div"),et=i("div"),A=i("label"),A.textContent=Fe,se=C(),k=i("input"),ie=C(),at=i("div"),rt=i("div"),rt.textContent=we,de=C(),lt=i("div"),ne=p("R$ "),kt=p(pt),ce=C(),ot=i("div"),st=i("div"),st.textContent=Re,ue=C(),B=i("div"),ve=p("R$ "),yt=p(gt),fe=C(),M=i("div"),H=i("a"),H.textContent=ke,_e=C(),P=i("button"),qt=p(Ct),this.h()},l(b){e=s(b,"SECTION",{class:!0});var _=h(e);d=s(_,"DIV",{class:!0});var Ot=h(d);a=s(Ot,"DIV",{});var Tt=h(a);u=s(Tt,"DIV",{class:!0,"data-svelte-h":!0}),R(u)!=="svelte-tk8r7n"&&(u.textContent=F),m=g(Tt),I=s(Tt,"DIV",{class:!0});var Se=h(I);N=x(Se,V),Se.forEach(c),Tt.forEach(c),r=g(Ot),f=s(Ot,"DIV",{});var Lt=h(f);E=s(Lt,"DIV",{class:!0,"data-svelte-h":!0}),R(E)!=="svelte-b116ns"&&(E.textContent=it),j=g(Lt),L=s(Lt,"DIV",{class:!0});var he=h(L);ut=x(he,"R$ "),v=x(he,o),he.forEach(c),Lt.forEach(c),Ot.forEach(c),K=g(_),D=s(_,"DIV",{class:!0});var z=h(D);y=s(z,"DIV",{class:!0});var Pt=h(y);S=s(Pt,"DIV",{class:!0,"data-svelte-h":!0}),R(S)!=="svelte-xhro2f"&&(S.textContent=De),zt=g(Pt),Q=s(Pt,"DIV",{class:!0});var be=h(Q);Jt=x(be,"R$ "),Dt=x(be,vt),be.forEach(c),Pt.forEach(c),Kt=g(z),q=s(z,"DIV",{class:!0});var dt=h(q);W=s(dt,"DIV",{class:!0,"data-svelte-h":!0}),R(W)!=="svelte-1fitdcb"&&(W.textContent=Ie),Qt=g(dt),X=s(dt,"DIV",{class:!0});var xe=h(X);Wt=x(xe,"R$ "),It=x(xe,ft),xe.forEach(c),Xt=g(dt),O=s(dt,"DIV",{class:!0});var nt=h(O);Yt=x(nt,"Débito R$ "),Vt=x(nt,_t),Zt=x(nt," · Crédito R$ "),Et=x(nt,mt),Ft=x(nt,ht),nt.forEach(c),dt.forEach(c),$t=g(z),G=s(z,"DIV",{class:!0});var jt=h(G);Y=s(jt,"DIV",{class:!0,"data-svelte-h":!0}),R(Y)!=="svelte-w5fx2e"&&(Y.textContent=Ve),te=g(jt),Z=s(jt,"DIV",{class:!0});var pe=h(Z);ee=x(pe,"R$ "),wt=x(pe,bt),pe.forEach(c),jt.forEach(c),ae=g(z),U=s(z,"DIV",{class:!0});var Gt=h(U);$=s(Gt,"DIV",{class:!0,"data-svelte-h":!0}),R($)!=="svelte-1g4b517"&&($.textContent=Ee),re=g(Gt),tt=s(Gt,"DIV",{class:!0});var ge=h(tt);le=x(ge,"R$ "),Rt=x(ge,xt),ge.forEach(c),Gt.forEach(c),z.forEach(c),oe=g(_),T=s(_,"DIV",{class:!0});var ct=h(T);et=s(ct,"DIV",{});var Ut=h(et);A=s(Ut,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),R(A)!=="svelte-dratt4"&&(A.textContent=Fe),se=g(Ut),k=s(Ut,"INPUT",{id:!0,type:!0,step:!0,min:!0,class:!0}),Ut.forEach(c),ie=g(ct),at=s(ct,"DIV",{});var At=h(at);rt=s(At,"DIV",{class:!0,"data-svelte-h":!0}),R(rt)!=="svelte-jqh7sq"&&(rt.textContent=we),de=g(At),lt=s(At,"DIV",{class:!0});var Ce=h(lt);ne=x(Ce,"R$ "),kt=x(Ce,pt),Ce.forEach(c),At.forEach(c),ce=g(ct),ot=s(ct,"DIV",{});var Bt=h(ot);st=s(Bt,"DIV",{class:!0,"data-svelte-h":!0}),R(st)!=="svelte-121y65r"&&(st.textContent=Re),ue=g(Bt),B=s(Bt,"DIV",{class:!0});var Ne=h(B);ve=x(Ne,"R$ "),yt=x(Ne,gt),Ne.forEach(c),Bt.forEach(c),ct.forEach(c),fe=g(_),M=s(_,"DIV",{class:!0});var Mt=h(M);H=s(Mt,"A",{href:!0,class:!0,"data-svelte-h":!0}),R(H)!=="svelte-1m5vat4"&&(H.textContent=ke),_e=g(Mt),P=s(Mt,"BUTTON",{class:!0});var qe=h(P);qt=x(qe,Ct),qe.forEach(c),Mt.forEach(c),_.forEach(c),this.h()},h(){l(u,"class","text-sm text-slate-500"),l(I,"class","font-medium"),l(E,"class","text-sm text-slate-500"),l(L,"class","font-medium"),l(d,"class","grid sm:grid-cols-2 gap-4"),l(S,"class","text-xs text-slate-500"),l(Q,"class","text-lg font-semibold"),l(y,"class","p-3 rounded border bg-white dark:bg-slate-800"),l(W,"class","text-xs text-slate-500"),l(X,"class","text-lg font-semibold"),l(O,"class","text-xs text-slate-500 mt-1"),l(q,"class","p-3 rounded border bg-white dark:bg-slate-800"),l(Y,"class","text-xs text-slate-500"),l(Z,"class","text-lg font-semibold"),l(G,"class","p-3 rounded border bg-white dark:bg-slate-800"),l($,"class","text-xs text-slate-500"),l(tt,"class","text-lg font-semibold"),l(U,"class","p-3 rounded border bg-white dark:bg-slate-800"),l(D,"class","grid sm:grid-cols-4 gap-4"),l(A,"for","valor-em-gaveta"),l(A,"class","block text-sm mb-1"),l(k,"id","valor-em-gaveta"),l(k,"type","number"),l(k,"step","0.01"),l(k,"min","0"),l(k,"class","input-form"),l(rt,"class","text-sm text-slate-500"),l(lt,"class","text-lg font-semibold"),l(st,"class","text-sm text-slate-500"),l(B,"class",St="text-lg font-semibold "+(n[8]===0?"text-slate-900":n[8]>0?"text-green-700":"text-red-700")),l(T,"class","grid sm:grid-cols-3 gap-4 items-end"),l(H,"href","/app"),l(H,"class","btn-secondary"),l(P,"class","btn-primary"),P.disabled=n[7],l(M,"class","flex justify-end gap-2"),l(e,"class","bg-white dark:bg-slate-800 rounded-lg shadow p-4 space-y-4")},m(b,_){J(b,e,_),t(e,d),t(d,a),t(a,u),t(a,m),t(a,I),t(I,N),t(d,r),t(d,f),t(f,E),t(f,j),t(f,L),t(L,ut),t(L,v),t(e,K),t(e,D),t(D,y),t(y,S),t(y,zt),t(y,Q),t(Q,Jt),t(Q,Dt),t(D,Kt),t(D,q),t(q,W),t(q,Qt),t(q,X),t(X,Wt),t(X,It),t(q,Xt),t(q,O),t(O,Yt),t(O,Vt),t(O,Zt),t(O,Et),t(O,Ft),t(D,$t),t(D,G),t(G,Y),t(G,te),t(G,Z),t(Z,ee),t(Z,wt),t(D,ae),t(D,U),t(U,$),t(U,re),t(U,tt),t(tt,le),t(tt,Rt),t(e,oe),t(e,T),t(T,et),t(et,A),t(et,se),t(et,k),Te(k,n[1]),t(T,ie),t(T,at),t(at,rt),t(at,de),t(at,lt),t(lt,ne),t(lt,kt),t(T,ce),t(T,ot),t(ot,st),t(ot,ue),t(ot,B),t(B,ve),t(B,yt),t(e,fe),t(e,M),t(M,H),t(M,_e),t(M,P),t(P,qt),me||(ye=[Le(k,"input",n[12]),Le(P,"click",n[10])],me=!0)},p(b,_){_&1&&V!==(V=new Date(b[0].data_abertura).toLocaleString()+"")&&w(N,V),_&1&&o!==(o=Number(b[0].valor_inicial||0).toFixed(2)+"")&&w(v,o),_&8&&vt!==(vt=Number(b[3].dinheiro).toFixed(2)+"")&&w(Dt,vt),_&16&&ft!==(ft=Number(b[4]).toFixed(2)+"")&&w(It,ft),_&8&&_t!==(_t=Number(b[3].cartao_debito).toFixed(2)+"")&&w(Vt,_t),_&8&&mt!==(mt=Number(b[3].cartao_credito).toFixed(2)+"")&&w(Et,mt),_&8&&ht!==(ht=b[3].cartao_legacy>0?` · Outros R$ ${Number(b[3].cartao_legacy).toFixed(2)}`:"")&&w(Ft,ht),_&8&&bt!==(bt=Number(b[3].pix).toFixed(2)+"")&&w(wt,bt),_&512&&xt!==(xt=Number(b[9]).toFixed(2)+"")&&w(Rt,xt),_&2&&je(k.value)!==b[1]&&Te(k,b[1]),_&4&&pt!==(pt=Number(b[2]).toFixed(2)+"")&&w(kt,pt),_&256&&gt!==(gt=Number(b[8]).toFixed(2)+"")&&w(yt,gt),_&256&&St!==(St="text-lg font-semibold "+(b[8]===0?"text-slate-900":b[8]>0?"text-green-700":"text-red-700"))&&l(B,"class",St),_&128&&Ct!==(Ct=b[7]?"Fechando...":"Fechar Caixa")&&w(qt,Ct),_&128&&(P.disabled=b[7])},d(b){b&&c(e),me=!1,Ae(ye)}}}function ze(n){let e,d="Nenhum caixa aberto encontrado para seu usuário.";return{c(){e=i("div"),e.textContent=d,this.h()},l(a){e=s(a,"DIV",{class:!0,"data-svelte-h":!0}),R(e)!=="svelte-17g287d"&&(e.textContent=d),this.h()},h(){l(e,"class","text-sm text-slate-600")},m(a,u){J(a,e,u)},p:Ht,d(a){a&&c(e)}}}function Je(n){let e,d="Carregando...";return{c(){e=i("div"),e.textContent=d},l(a){e=s(a,"DIV",{"data-svelte-h":!0}),R(e)!=="svelte-btlswi"&&(e.textContent=d)},m(a,u){J(a,e,u)},p:Ht,d(a){a&&c(e)}}}function Ke(n){let e,d="Fechar Caixa",a,u,F,m=n[6]&&Pe(n);function I(r,f){return r[5]?Je:r[0]?He:ze}let V=I(n),N=V(n);return{c(){e=i("h1"),e.textContent=d,a=C(),m&&m.c(),u=C(),N.c(),F=Oe(),this.h()},l(r){e=s(r,"H1",{class:!0,"data-svelte-h":!0}),R(e)!=="svelte-iq5a4r"&&(e.textContent=d),a=g(r),m&&m.l(r),u=g(r),N.l(r),F=Oe(),this.h()},h(){l(e,"class","text-2xl font-semibold mb-4")},m(r,f){J(r,e,f),J(r,a,f),m&&m.m(r,f),J(r,u,f),N.m(r,f),J(r,F,f)},p(r,[f]){r[6]?m?m.p(r,f):(m=Pe(r),m.c(),m.m(u.parentNode,u)):m&&(m.d(1),m=null),V===(V=I(r))&&N?N.p(r,f):(N.d(1),N=V(r),N&&(N.c(),N.m(F.parentNode,F)))},i:Ht,o:Ht,d(r){r&&(c(e),c(a),c(u),c(F)),m&&m.d(r),N.d(r)}}}function Qe(n,e,d){let a,u,F,m,I,V=!0,N="",r=null,f=[],E=0,it=!1,j=null;Ue(async()=>{var o;try{const{data:v}=await Nt.auth.getUser();if(j=(o=v==null?void 0:v.user)==null?void 0:o.id,!j){window.location.href="/login";return}const{data:K,error:D}=await Nt.from("caixas").select("id, data_abertura, valor_inicial").eq("id_usuario",j).is("data_fechamento",null).order("data_abertura",{ascending:!1}).limit(1);if(D)throw D;if(!K||K.length===0){d(0,r=null),d(5,V=!1);return}d(0,r=K[0]);const{data:y,error:S}=await Nt.from("vendas").select("id, valor_total, forma_pagamento, valor_recebido, valor_troco").eq("id_caixa",r.id).order("id",{ascending:!0});if(S)throw S;d(11,f=y||[])}catch(v){d(6,N=(v==null?void 0:v.message)||"Erro ao carregar caixa.")}finally{d(5,V=!1)}});async function L(){if(r){d(7,it=!0);try{const{error:o}=await Nt.from("caixas").update({data_fechamento:new Date().toISOString(),valor_fechamento:Number(E),diferenca_fechamento:Number(I)}).eq("id",r.id);if(o)throw o;try{await Nt.from("caixa_fechamentos").insert({id_caixa:r.id,id_usuario:j,data_fechamento:new Date().toISOString(),total_dinheiro:Number(a.dinheiro||0),total_cartao:Number(u||0),total_pix:Number(a.pix||0),total_geral:Number(F||0),valor_inicial:Number(r.valor_inicial||0),valor_esperado_em_gaveta:Number(m||0),valor_contado_em_gaveta:Number(E||0),diferenca:Number(I||0),quantidade_vendas:(f||[]).length})}catch(v){console.warn("Falha ao registrar histórico de fechamento:",(v==null?void 0:v.message)||v)}alert("Caixa fechado com sucesso."),window.location.href="/admin"}catch(o){d(6,N=(o==null?void 0:o.message)||"Erro ao fechar caixa.")}finally{d(7,it=!1)}}}function ut(){E=je(this.value),d(1,E)}return n.$$.update=()=>{n.$$.dirty&2048&&d(3,a={dinheiro:(f||[]).filter(o=>o.forma_pagamento==="dinheiro").reduce((o,v)=>o+Number(v.valor_total||0),0),cartao_debito:(f||[]).filter(o=>o.forma_pagamento==="cartao_debito").reduce((o,v)=>o+Number(v.valor_total||0),0),cartao_credito:(f||[]).filter(o=>o.forma_pagamento==="cartao_credito").reduce((o,v)=>o+Number(v.valor_total||0),0),cartao_legacy:(f||[]).filter(o=>o.forma_pagamento==="cartao").reduce((o,v)=>o+Number(v.valor_total||0),0),pix:(f||[]).filter(o=>o.forma_pagamento==="pix").reduce((o,v)=>o+Number(v.valor_total||0),0)}),n.$$.dirty&8&&d(4,u=Number(a.cartao_debito+a.cartao_credito+a.cartao_legacy)),n.$$.dirty&24&&d(9,F=Number(a.dinheiro+u+a.pix)),n.$$.dirty&2049&&d(2,m=r?Number(r.valor_inicial||0)+(f||[]).filter(o=>o.forma_pagamento==="dinheiro").reduce((o,v)=>o+Number(v.valor_recebido||0)-Number(v.valor_troco||0),0):0),n.$$.dirty&6&&d(8,I=Number(E||0)-Number(m||0))},[r,E,m,a,u,V,N,it,I,F,L,f,ut]}class Ze extends Be{constructor(e){super(),Me(this,e,Qe,Ke,Ge,{})}}export{Ze as component};
