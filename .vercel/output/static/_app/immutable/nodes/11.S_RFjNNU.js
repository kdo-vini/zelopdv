import{s as Zt,n as vt,r as ft,o as Gt}from"../chunks/DUJQqtHE.js";import{S as Jt,i as Wt,d,s as Oe,a as fe,b as a,v as G,o,c as s,e as g,p as K,g as I,f as le,n as Dt,h as i,j as T,t as re,I as _t,r as lt,u as Ye,z as Nt,J as Et}from"../chunks/CBbGAyDJ.js";import{e as gt,u as It,d as Tt}from"../chunks/BMMEC0mH.js";import{s as be}from"../chunks/BxpIoVra.js";import{e as Yt}from"../chunks/GGIVe_N_.js";const Kt=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function $e(l){return l==null?"":String(l).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")}function Xt(l){return l?l==="dinheiro"?"Dinheiro":l==="cartao"?"Cartão":l==="cartao_debito"?"Cartão (débito)":l==="cartao_credito"?"Cartão (crédito)":l==="pix"?"Pix":String(l).charAt(0).toUpperCase()+String(l).slice(1):""}function $t({estabelecimento:l={},venda:t={},options:e={}}={}){const r=x=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(x||0)),m=new Date,y=(l==null?void 0:l.nome_exibicao)||"Zelo PDV",n=(l==null?void 0:l.documento)||null,p=(l==null?void 0:l.contato)||null,u=(l==null?void 0:l.endereco)||null,N=(l==null?void 0:l.largura_bobina)||"80mm",v=(l==null?void 0:l.logoUrl)||(l==null?void 0:l.logotipo_url)||null,h=(t.itens||[]).map(x=>{const V=String(x.nome||x.nome_produto_na_venda||"").replace(/^\s*\d+\s*x\s*/i,""),C=Number(x.quantidade||1),L=Number(x.preco_unitario||x.preco_unitario_na_venda||0),P=C*L;return`<tr>
      <td class="qtd">${C}x</td>
      <td class="produto">${$e(V)}</td>
      <td class="subtotal">${r(P)}</td>
    </tr>`}).join(""),b=(t.itens||[]).reduce((x,V)=>x+Number(V.quantidade||1)*Number(V.preco_unitario||V.preco_unitario_na_venda||0),0),c=t.total!=null?Number(t.total):Number(b),q=t.valorRecebido!=null?Number(t.valorRecebido):null,A=t.troco!=null?Number(t.troco):q!=null?q-c:0;let R=[];u&&R.push($e(u)),p&&R.push($e(p)),n&&R.push(`CNPJ/CPF: ${$e(n)}`);const w=R.length?R.join(" • "):"";return`<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Recibo - ${$e(y)}</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { font-family: -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin:0; padding:8px; color:#222; }
    .cupom { width: ${N==="58mm"?"220px":"320px"}; max-width:100%; margin:0 auto; }
    header { text-align:center; padding-bottom:8px; border-bottom:1px dashed #ddd; }
    .logo { max-height:56px; max-width:100%; object-fit:contain; margin-bottom:6px; }
    h1.nome { font-size:16px; font-weight:600; margin:4px 0 0; }
    .meta { font-size:11px; color:#555; margin-top:6px; line-height:1.4; }
    .pedido { margin-top:8px; font-size:12px; display:flex; justify-content:space-between; }
    table.items { width:100%; border-collapse:collapse; margin-top:8px; font-size:12px; }
    table.items td, table.items th { padding:4px 0; vertical-align:top; }
    table.items thead th { font-size:11px; color:#555; text-align:left; padding-bottom:6px; border-bottom:1px solid #eee; }
    .qtd { width:28px; }
    .subtotal { width:90px; text-align:right; }
    .totais { margin-top:8px; border-top:1px dashed #ddd; padding-top:6px; font-size:13px; }
    .totais .linha { display:flex; justify-content:space-between; margin:4px 0; }
    .totais .total { font-weight:700; font-size:15px; }
    .rodape { text-align:center; font-size:11px; color:#666; margin-top:10px; line-height:1.4; }
    @media print { body { margin:0; } .cupom { padding:0; } }
  </style>
</head>
<body onload="window.print(); setTimeout(()=>window.close(), 300);">
  <div class="cupom">
    <header>
      ${v?`<img class="logo" src="${$e(v)}" alt="Logo" onerror="this.style.display='none'" />`:""}
      <h1 class="nome">${$e(y)}</h1>
      ${w?`<div class="meta">${w}</div>`:""}
    </header>

    <div class="pedido">
      <div>Pedido: <strong>${$e(String(t.idVenda||t.id||"—"))}</strong></div>
      <div>${m.toLocaleDateString("pt-BR")} ${m.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}</div>
    </div>

    <table class="items" aria-label="Itens">
      <thead>
        <tr>
          <th class="qtd">Qtd</th>
          <th>Produto</th>
          <th class="subtotal">Total</th>
        </tr>
      </thead>
      <tbody>
        ${h||'<tr><td colspan="4" style="text-align:center;color:#999;padding:12px 0">Nenhum item</td></tr>'}
      </tbody>
    </table>

    <div class="totais">
      <div class="linha"><span>Subtotal</span><span>${r(b)}</span></div>
      <div class="linha total"><span>Total</span><strong>${r(c)}</strong></div>
      ${q!=null?`<div class="linha"><span>Recebido</span><span>${r(q)}</span></div>`:""}
      ${A>0?`<div class="linha"><span>Troco</span><span>${r(A)}</span></div>`:""}
      <div style="margin-top:6px" class="linha"><span>Pagamento</span><strong>${$e(Xt(t.formaPagamento))}</strong></div>
    </div>

    <div class="rodape">
      Obrigado pela preferência!<br/>
      ${$e(p||y)}
    </div>

  </div>
</body>
</html>`}const{Map:qt}=Kt;function Vt(l,t,e){const r=l.slice();return r[84]=t[e],r}function At(l,t,e){const r=l.slice();return r[87]=t[e],r}function Rt(l,t,e){const r=l.slice();return r[90]=t[e],r}function eo(l){let t,e="Atualizar",r,m;return{c(){t=i("button"),t.textContent=e,this.h()},l(y){t=s(y,"BUTTON",{class:!0,"data-svelte-h":!0}),K(t)!=="svelte-1dr5nab"&&(t.textContent=e),this.h()},h(){o(t,"class","underline hover:text-gray-700")},m(y,n){fe(y,t,n),r||(m=G(t,"click",l[31]),r=!0)},p:vt,d(y){y&&d(t),r=!1,m()}}}function to(l){let t,e="Atualizando…";return{c(){t=i("span"),t.textContent=e},l(r){t=s(r,"SPAN",{"data-svelte-h":!0}),K(t)!=="svelte-1tn5m84"&&(t.textContent=e)},m(r,m){fe(r,t,m)},p:vt,d(r){r&&d(t)}}}function Pt(l,t){let e,r,m=t[90].nome+"",y,n,p,u;function N(){return t[44](t[90])}return{key:l,first:null,c(){e=i("button"),r=i("span"),y=re(m),n=T(),this.h()},l(v){e=s(v,"BUTTON",{class:!0});var h=g(e);r=s(h,"SPAN",{});var b=g(r);y=le(b,m),b.forEach(d),n=I(h),h.forEach(d),this.h()},h(){o(e,"class","w-full h-24 p-2 flex flex-col items-center justify-center text-center text-xs font-medium border-b border-gray-700"),_t(e,"bg-white",t[0]===t[90].id),_t(e,"text-gray-900",t[0]===t[90].id),_t(e,"hover:bg-gray-700",t[0]!==t[90].id),this.first=e},m(v,h){fe(v,e,h),a(e,r),a(r,y),a(e,n),p||(u=G(e,"click",N),p=!0)},p(v,h){t=v,h[0]&32&&m!==(m=t[90].nome+"")&&Oe(y,m),h[0]&33&&_t(e,"bg-white",t[0]===t[90].id),h[0]&33&&_t(e,"text-gray-900",t[0]===t[90].id),h[0]&33&&_t(e,"hover:bg-gray-700",t[0]!==t[90].id)},d(v){v&&d(e),p=!1,u()}}}function oo(l){let t,e=[],r=new qt,m,y,n='<div class="p-3 flex flex-col justify-center items-center h-full"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-8 h-8 mb-1"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"></path></svg> <span class="text-sm font-semibold text-center leading-tight">Item Avulso</span></div>',p,u,N=gt(l[30]);const v=h=>h[87].id;for(let h=0;h<N.length;h+=1){let b=At(l,N,h),c=v(b);r.set(c,e[h]=Ut(c,b))}return{c(){t=i("div");for(let h=0;h<e.length;h+=1)e[h].c();m=T(),y=i("button"),y.innerHTML=n,this.h()},l(h){t=s(h,"DIV",{class:!0});var b=g(t);for(let c=0;c<e.length;c+=1)e[c].l(b);m=I(b),y=s(b,"BUTTON",{class:!0,"data-svelte-h":!0}),K(y)!=="svelte-1ryun3n"&&(y.innerHTML=n),b.forEach(d),this.h()},h(){o(y,"class","h-32 bg-yellow-100 border-2 border-dashed border-yellow-400 text-yellow-700 rounded-lg shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all"),o(t,"class","grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4")},m(h,b){fe(h,t,b);for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(t,null);a(t,m),a(t,y),p||(u=G(y,"click",l[46]),p=!0)},p(h,b){b[0]&1073741824|b[1]&2&&(N=gt(h[30]),e=It(e,b,v,1,h,N,r,t,Tt,Ut,m,At))},d(h){h&&d(t);for(let b=0;b<e.length;b+=1)e[b].d();p=!1,u()}}}function ao(l){let t,e="Carregando produtos...";return{c(){t=i("p"),t.textContent=e},l(r){t=s(r,"P",{"data-svelte-h":!0}),K(t)!=="svelte-72r0s6"&&(t.textContent=e)},m(r,m){fe(r,t,m)},p:vt,d(r){r&&d(t)}}}function Ut(l,t){let e,r,m,y=t[87].nome+"",n,p,u,N,v=Number(t[87].preco).toFixed(2)+"",h,b,c,q;function A(){return t[45](t[87])}return{key:l,first:null,c(){e=i("button"),r=i("div"),m=i("span"),n=re(y),p=T(),u=i("span"),N=re("R$ "),h=re(v),b=T(),this.h()},l(R){e=s(R,"BUTTON",{class:!0});var w=g(e);r=s(w,"DIV",{class:!0});var k=g(r);m=s(k,"SPAN",{class:!0});var x=g(m);n=le(x,y),x.forEach(d),p=I(k),u=s(k,"SPAN",{class:!0});var V=g(u);N=le(V,"R$ "),h=le(V,v),V.forEach(d),k.forEach(d),b=I(w),w.forEach(d),this.h()},h(){o(m,"class","text-sm font-semibold text-gray-800 text-left leading-tight"),o(u,"class","text-lg font-bold text-blue-600 text-right"),o(r,"class","p-3 flex flex-col justify-between h-full"),o(e,"class","h-32 bg-white rounded-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-shadow"),this.first=e},m(R,w){fe(R,e,w),a(e,r),a(r,m),a(m,n),a(r,p),a(r,u),a(u,N),a(u,h),a(e,b),c||(q=G(e,"click",A),c=!0)},p(R,w){t=R,w[0]&1073741824&&y!==(y=t[87].nome+"")&&Oe(n,y),w[0]&1073741824&&v!==(v=Number(t[87].preco).toFixed(2)+"")&&Oe(h,v)},d(R){R&&d(e),c=!1,q()}}}function lo(l){let t,e=[],r=new qt,m=gt(l[1]);const y=n=>n[84].id;for(let n=0;n<m.length;n+=1){let p=Vt(l,m,n),u=y(p);r.set(u,e[n]=Lt(u,p))}return{c(){t=i("ul");for(let n=0;n<e.length;n+=1)e[n].c();this.h()},l(n){t=s(n,"UL",{class:!0});var p=g(t);for(let u=0;u<e.length;u+=1)e[u].l(p);p.forEach(d),this.h()},h(){o(t,"class","space-y-3")},m(n,p){fe(n,t,p);for(let u=0;u<e.length;u+=1)e[u]&&e[u].m(t,null)},p(n,p){p[0]&2|p[1]&12&&(m=gt(n[1]),e=It(e,p,y,1,n,m,r,t,Tt,Lt,null,Vt))},d(n){n&&d(t);for(let p=0;p<e.length;p+=1)e[p].d()}}}function ro(l){let t,e="<p>Clique em um item para adicionar</p>";return{c(){t=i("div"),t.innerHTML=e,this.h()},l(r){t=s(r,"DIV",{class:!0,"data-svelte-h":!0}),K(t)!=="svelte-tpdfri"&&(t.innerHTML=e),this.h()},h(){o(t,"class","flex items-center justify-center h-full text-gray-500")},m(r,m){fe(r,t,m)},p:vt,d(r){r&&d(t)}}}function Lt(l,t){let e,r,m,y=t[84].nome+"",n,p,u,N,v=Number(t[84].preco).toFixed(2)+"",h,b,c,q,A="-",R,w,k=t[84].quantidade+"",x,V,C,L="+",P,te,F;function W(){return t[47](t[84])}function j(){return t[48](t[84])}return{key:l,first:null,c(){e=i("li"),r=i("div"),m=i("p"),n=re(y),p=T(),u=i("p"),N=re("R$ "),h=re(v),b=T(),c=i("div"),q=i("button"),q.textContent=A,R=T(),w=i("span"),x=re(k),V=T(),C=i("button"),C.textContent=L,P=T(),this.h()},l(Q){e=s(Q,"LI",{class:!0});var B=g(e);r=s(B,"DIV",{class:!0});var S=g(r);m=s(S,"P",{class:!0});var z=g(m);n=le(z,y),z.forEach(d),p=I(S),u=s(S,"P",{class:!0});var me=g(u);N=le(me,"R$ "),h=le(me,v),me.forEach(d),S.forEach(d),b=I(B),c=s(B,"DIV",{class:!0});var J=g(c);q=s(J,"BUTTON",{class:!0,"data-svelte-h":!0}),K(q)!=="svelte-n32k1l"&&(q.textContent=A),R=I(J),w=s(J,"SPAN",{class:!0});var X=g(w);x=le(X,k),X.forEach(d),V=I(J),C=s(J,"BUTTON",{class:!0,"data-svelte-h":!0}),K(C)!=="svelte-12fsyl"&&(C.textContent=L),J.forEach(d),P=I(B),B.forEach(d),this.h()},h(){o(m,"class","text-sm font-medium text-gray-900"),o(u,"class","text-sm text-gray-600"),o(r,"class","flex-1"),o(q,"class","w-9 h-9 text-lg font-bold text-red-600 hover:bg-red-50 dark:hover:bg-slate-700 rounded-l-md"),o(w,"class","w-12 h-9 text-center leading-9 text-base font-semibold text-slate-900 dark:text-slate-100"),o(C,"class","w-9 h-9 text-lg font-bold text-green-600 hover:bg-green-50 dark:hover:bg-slate-700 rounded-r-md"),o(c,"class","flex items-center border border-gray-300 rounded-md bg-white dark:bg-slate-800"),o(e,"class","flex items-center space-x-2"),this.first=e},m(Q,B){fe(Q,e,B),a(e,r),a(r,m),a(m,n),a(r,p),a(r,u),a(u,N),a(u,h),a(e,b),a(e,c),a(c,q),a(c,R),a(c,w),a(w,x),a(c,V),a(c,C),a(e,P),te||(F=[G(q,"click",W),G(C,"click",j)],te=!0)},p(Q,B){t=Q,B[0]&2&&y!==(y=t[84].nome+"")&&Oe(n,y),B[0]&2&&v!==(v=Number(t[84].preco).toFixed(2)+"")&&Oe(h,v),B[0]&2&&k!==(k=t[84].quantidade+"")&&Oe(x,k)},d(Q){Q&&d(e),te=!1,ft(F)}}}function St(l){let t,e,r,m="Abrir Caixa",y,n,p="Você precisa abrir o caixa antes de registrar vendas.",u,N,v,h="Valor do Troco Inicial (R$)",b,c,q,A,R='<button type="submit" class="btn-primary">Abrir Caixa</button>',w,k;return{c(){t=i("div"),e=i("div"),r=i("h3"),r.textContent=m,y=T(),n=i("p"),n.textContent=p,u=T(),N=i("form"),v=i("label"),v.textContent=h,b=T(),c=i("input"),q=T(),A=i("div"),A.innerHTML=R,this.h()},l(x){t=s(x,"DIV",{class:!0});var V=g(t);e=s(V,"DIV",{class:!0});var C=g(e);r=s(C,"H3",{class:!0,"data-svelte-h":!0}),K(r)!=="svelte-8rsru7"&&(r.textContent=m),y=I(C),n=s(C,"P",{class:!0,"data-svelte-h":!0}),K(n)!=="svelte-19k5arx"&&(n.textContent=p),u=I(C),N=s(C,"FORM",{});var L=g(N);v=s(L,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),K(v)!=="svelte-17sb1yj"&&(v.textContent=h),b=I(L),c=s(L,"INPUT",{id:!0,type:!0,step:!0,min:!0,class:!0}),q=I(L),A=s(L,"DIV",{class:!0,"data-svelte-h":!0}),K(A)!=="svelte-kinz5s"&&(A.innerHTML=R),L.forEach(d),C.forEach(d),V.forEach(d),this.h()},h(){o(r,"class","text-lg font-medium leading-6 text-gray-900 mb-4"),o(n,"class","text-sm text-gray-600 mb-4"),o(v,"for","troco-inicial"),o(v,"class","block text-sm font-medium text-gray-700"),o(c,"id","troco-inicial"),o(c,"type","number"),o(c,"step","0.01"),o(c,"min","0"),o(c,"class","mt-1 input-form"),c.required=!0,o(A,"class","mt-6 flex justify-end"),o(e,"class","modal-content"),o(t,"class","modal-backdrop")},m(x,V){fe(x,t,V),a(t,e),a(e,r),a(e,y),a(e,n),a(e,u),a(e,N),a(N,v),a(N,b),a(N,c),Ye(c,l[26]),a(N,q),a(N,A),w||(k=[G(c,"input",l[49]),G(N,"submit",Nt(l[38]))],w=!0)},p(x,V){V[0]&67108864&&lt(c.value)!==x[26]&&Ye(c,x[26])},d(x){x&&d(t),w=!1,ft(k)}}}function Mt(l){var te;let t,e,r,m=(l[8]?l[8].nome:"Selecionar quantidade")+"",y,n,p,u,N,v="Quantidade",h,b,c,q,A,R,w="Cancelar",k,x,V="Adicionar",C,L,P=((te=l[8])==null?void 0:te.controlar_estoque)&&Bt(l);return{c(){t=i("div"),e=i("div"),r=i("h3"),y=re(m),n=T(),p=i("form"),u=i("div"),N=i("label"),N.textContent=v,h=T(),b=i("input"),c=T(),P&&P.c(),q=T(),A=i("div"),R=i("button"),R.textContent=w,k=T(),x=i("button"),x.textContent=V,this.h()},l(F){t=s(F,"DIV",{class:!0,role:!0,tabindex:!0,"aria-label":!0});var W=g(t);e=s(W,"DIV",{class:!0,role:!0,"aria-modal":!0,"aria-labelledby":!0});var j=g(e);r=s(j,"H3",{id:!0,class:!0});var Q=g(r);y=le(Q,m),Q.forEach(d),n=I(j),p=s(j,"FORM",{class:!0});var B=g(p);u=s(B,"DIV",{});var S=g(u);N=s(S,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),K(N)!=="svelte-i4pyfr"&&(N.textContent=v),h=I(S),b=s(S,"INPUT",{id:!0,type:!0,min:!0,step:!0,class:!0}),c=I(S),P&&P.l(S),S.forEach(d),q=I(B),A=s(B,"DIV",{class:!0});var z=g(A);R=s(z,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),K(R)!=="svelte-q75lak"&&(R.textContent=w),k=I(z),x=s(z,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),K(x)!=="svelte-19guswl"&&(x.textContent=V),z.forEach(d),B.forEach(d),j.forEach(d),W.forEach(d),this.h()},h(){o(r,"id","titulo-quantidade"),o(r,"class","text-lg font-medium leading-6 text-gray-900 dark:text-gray-100 mb-4"),o(N,"for","qtd-input"),o(N,"class","block text-sm font-medium text-gray-800 dark:text-gray-200"),o(b,"id","qtd-input"),o(b,"type","number"),o(b,"min","1"),o(b,"step","1"),o(b,"class","mt-1 input-form"),b.required=!0,o(R,"type","button"),o(R,"class","btn-secondary mr-2"),o(x,"type","submit"),o(x,"class","btn-primary"),o(A,"class","mt-6 flex justify-end"),o(p,"class","space-y-4"),o(e,"class","modal-content text-gray-900 dark:text-gray-100"),o(e,"role","dialog"),o(e,"aria-modal","true"),o(e,"aria-labelledby","titulo-quantidade"),o(t,"class","modal-backdrop"),o(t,"role","button"),o(t,"tabindex","0"),o(t,"aria-label","Fechar modal de quantidade")},m(F,W){fe(F,t,W),a(t,e),a(e,r),a(r,y),a(e,n),a(e,p),a(p,u),a(u,N),a(u,h),a(u,b),Ye(b,l[9]),a(u,c),P&&P.m(u,null),a(p,q),a(p,A),a(A,R),a(A,k),a(A,x),C||(L=[G(b,"input",l[50]),G(R,"click",l[51]),G(p,"submit",Nt(l[40])),G(t,"keydown",l[52]),G(t,"click",Et(l[53]))],C=!0)},p(F,W){var j;W[0]&256&&m!==(m=(F[8]?F[8].nome:"Selecionar quantidade")+"")&&Oe(y,m),W[0]&512&&lt(b.value)!==F[9]&&Ye(b,F[9]),(j=F[8])!=null&&j.controlar_estoque?P?P.p(F,W):(P=Bt(F),P.c(),P.m(u,null)):P&&(P.d(1),P=null)},d(F){F&&d(t),P&&P.d(),C=!1,ft(L)}}}function Bt(l){var y;let t,e,r=Number(((y=l[8])==null?void 0:y.estoque_atual)||0)+"",m;return{c(){t=i("p"),e=re("Disponível: "),m=re(r),this.h()},l(n){t=s(n,"P",{class:!0});var p=g(t);e=le(p,"Disponível: "),m=le(p,r),p.forEach(d),this.h()},h(){o(t,"class","mt-1 text-xs text-gray-500")},m(n,p){fe(n,t,p),a(t,e),a(t,m)},p(n,p){var u;p[0]&256&&r!==(r=Number(((u=n[8])==null?void 0:u.estoque_atual)||0)+"")&&Oe(m,r)},d(n){n&&d(t)}}}function Ft(l){let t,e,r,m="Item Avulso / Valor Personalizado",y,n,p,u,N="Nome do Item (Opcional)",v,h,b,c,q,A="Valor Total (R$)",R,w,k,x,V,C="Cancelar",L,P,te="Adicionar",F,W;return{c(){t=i("div"),e=i("div"),r=i("h3"),r.textContent=m,y=T(),n=i("form"),p=i("div"),u=i("label"),u.textContent=N,v=T(),h=i("input"),b=T(),c=i("div"),q=i("label"),q.textContent=A,R=T(),w=i("input"),k=T(),x=i("div"),V=i("button"),V.textContent=C,L=T(),P=i("button"),P.textContent=te,this.h()},l(j){t=s(j,"DIV",{class:!0,role:!0,tabindex:!0,"aria-label":!0});var Q=g(t);e=s(Q,"DIV",{class:!0,role:!0,"aria-modal":!0,"aria-labelledby":!0});var B=g(e);r=s(B,"H3",{id:!0,class:!0,"data-svelte-h":!0}),K(r)!=="svelte-scixp0"&&(r.textContent=m),y=I(B),n=s(B,"FORM",{class:!0});var S=g(n);p=s(S,"DIV",{});var z=g(p);u=s(z,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),K(u)!=="svelte-188n92c"&&(u.textContent=N),v=I(z),h=s(z,"INPUT",{id:!0,type:!0,class:!0}),z.forEach(d),b=I(S),c=s(S,"DIV",{});var me=g(c);q=s(me,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),K(q)!=="svelte-sa2rvj"&&(q.textContent=A),R=I(me),w=s(me,"INPUT",{id:!0,type:!0,step:!0,min:!0,class:!0}),me.forEach(d),k=I(S),x=s(S,"DIV",{class:!0});var J=g(x);V=s(J,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),K(V)!=="svelte-ai1rdw"&&(V.textContent=C),L=I(J),P=s(J,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),K(P)!=="svelte-19guswl"&&(P.textContent=te),J.forEach(d),S.forEach(d),B.forEach(d),Q.forEach(d),this.h()},h(){o(r,"id","titulo-valor-avulso"),o(r,"class","text-lg font-medium leading-6 text-gray-900 dark:text-gray-100 mb-4"),o(u,"for","nome-avulso"),o(u,"class","block text-sm font-medium text-gray-800 dark:text-gray-200"),o(h,"id","nome-avulso"),o(h,"type","text"),o(h,"class","mt-1 input-form"),o(q,"for","valor-avulso"),o(q,"class","block text-sm font-medium text-gray-800 dark:text-gray-200"),o(w,"id","valor-avulso"),o(w,"type","number"),o(w,"step","0.01"),o(w,"min","0.01"),o(w,"class","mt-1 input-form"),w.required=!0,o(V,"type","button"),o(V,"class","btn-secondary mr-2"),o(P,"type","submit"),o(P,"class","btn-primary"),o(x,"class","mt-6 flex justify-end"),o(n,"class","space-y-4"),o(e,"class","modal-content text-gray-900 dark:text-gray-100"),o(e,"role","dialog"),o(e,"aria-modal","true"),o(e,"aria-labelledby","titulo-valor-avulso"),o(t,"class","modal-backdrop"),o(t,"role","button"),o(t,"tabindex","0"),o(t,"aria-label","Fechar modal de valor avulso")},m(j,Q){fe(j,t,Q),a(t,e),a(e,r),a(e,y),a(e,n),a(n,p),a(p,u),a(p,v),a(p,h),Ye(h,l[12]),a(n,b),a(n,c),a(c,q),a(c,R),a(c,w),Ye(w,l[11]),a(n,k),a(n,x),a(x,V),a(x,L),a(x,P),F||(W=[G(h,"input",l[54]),G(w,"input",l[55]),G(V,"click",l[56]),G(n,"submit",Nt(l[39])),G(t,"keydown",l[57]),G(t,"click",Et(l[58]))],F=!0)},p(j,Q){Q[0]&4096&&h.value!==j[12]&&Ye(h,j[12]),Q[0]&2048&&lt(w.value)!==j[11]&&Ye(w,j[11])},d(j){j&&d(t),F=!1,ft(W)}}}function Ot(l){let t,e,r,m="Finalizar Pagamento",y,n,p,u,N="Total da Comanda",v,h,b,c=Number(l[4]).toFixed(2)+"",q,A,R,w,k,x="Forma de Pagamento",V,C,L,P,te,F,W,j,Q,B,S,z,me,J,X,je,Le,Ie,ye,ne,Ve,Qe,ke,Ce,Ae,qe,Se="Cancelar",pe,Y,he=l[14]?"Salvando...":l[16]?"Confirmar e imprimir":"Confirmar venda",Re,_e,Ze,se=l[2]==="dinheiro"&&jt(l),ie=l[15]&&zt(l);return{c(){t=i("div"),e=i("div"),r=i("h3"),r.textContent=m,y=T(),n=i("div"),p=i("div"),u=i("span"),u.textContent=N,v=T(),h=i("span"),b=re("R$ "),q=re(c),A=T(),R=i("div"),w=i("fieldset"),k=i("legend"),k.textContent=x,V=T(),C=i("div"),L=i("button"),P=re("Dinheiro"),F=T(),W=i("button"),j=re("Cartão (Débito)"),B=T(),S=i("button"),z=re("Cartão (Crédito)"),J=T(),X=i("button"),je=re("Pix"),Ie=T(),ye=i("label"),ne=i("input"),Ve=re(" Imprimir recibo ao confirmar"),Qe=T(),se&&se.c(),ke=T(),ie&&ie.c(),Ce=T(),Ae=i("div"),qe=i("button"),qe.textContent=Se,pe=T(),Y=i("button"),Re=re(he),this.h()},l(de){t=s(de,"DIV",{class:!0,role:!0,tabindex:!0,"aria-label":!0});var xe=g(t);e=s(xe,"DIV",{class:!0,role:!0,"aria-modal":!0,"aria-labelledby":!0});var Ge=g(e);r=s(Ge,"H3",{id:!0,class:!0,"data-svelte-h":!0}),K(r)!=="svelte-1nrmgha"&&(r.textContent=m),y=I(Ge),n=s(Ge,"DIV",{class:!0});var ve=g(n);p=s(ve,"DIV",{class:!0});var Ee=g(p);u=s(Ee,"SPAN",{class:!0,"data-svelte-h":!0}),K(u)!=="svelte-4zn4e6"&&(u.textContent=N),v=I(Ee),h=s(Ee,"SPAN",{class:!0});var ze=g(h);b=le(ze,"R$ "),q=le(ze,c),ze.forEach(d),Ee.forEach(d),A=I(ve),R=s(ve,"DIV",{});var et=g(R);w=s(et,"FIELDSET",{});var rt=g(w);k=s(rt,"LEGEND",{class:!0,"data-svelte-h":!0}),K(k)!=="svelte-1hpr256"&&(k.textContent=x),V=I(rt),C=s(rt,"DIV",{class:!0});var He=g(C);L=s(He,"BUTTON",{type:!0,class:!0,"aria-pressed":!0});var Be=g(L);P=le(Be,"Dinheiro"),Be.forEach(d),F=I(He),W=s(He,"BUTTON",{type:!0,class:!0,"aria-pressed":!0});var ct=g(W);j=le(ct,"Cartão (Débito)"),ct.forEach(d),B=I(He),S=s(He,"BUTTON",{type:!0,class:!0,"aria-pressed":!0});var nt=g(S);z=le(nt,"Cartão (Crédito)"),nt.forEach(d),J=I(He),X=s(He,"BUTTON",{type:!0,class:!0,"aria-pressed":!0});var Fe=g(X);je=le(Fe,"Pix"),Fe.forEach(d),He.forEach(d),rt.forEach(d),et.forEach(d),Ie=I(ve),ye=s(ve,"LABEL",{class:!0});var Ne=g(ye);ne=s(Ne,"INPUT",{type:!0}),Ve=le(Ne," Imprimir recibo ao confirmar"),Ne.forEach(d),Qe=I(ve),se&&se.l(ve),ke=I(ve),ie&&ie.l(ve),Ce=I(ve),Ae=s(ve,"DIV",{class:!0});var we=g(Ae);qe=s(we,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),K(qe)!=="svelte-1mdj8ju"&&(qe.textContent=Se),pe=I(we),Y=s(we,"BUTTON",{type:!0,class:!0});var Te=g(Y);Re=le(Te,he),Te.forEach(d),we.forEach(d),ve.forEach(d),Ge.forEach(d),xe.forEach(d),this.h()},h(){o(r,"id","titulo-pagamento"),o(r,"class","text-lg font-medium leading-6 text-gray-900 dark:text-gray-100 mb-4"),o(u,"class","text-gray-600 dark:text-gray-300"),o(h,"class","text-2xl font-bold dark:text-gray-100"),o(p,"class","flex justify-between items-center"),o(k,"class","block text-sm font-medium text-gray-800 dark:text-gray-200 mb-1"),o(L,"type","button"),o(L,"class","btn-secondary"),o(L,"aria-pressed",te=l[2]==="dinheiro"),o(W,"type","button"),o(W,"class","btn-secondary"),o(W,"aria-pressed",Q=l[2]==="cartao_debito"),o(S,"type","button"),o(S,"class","btn-secondary"),o(S,"aria-pressed",me=l[2]==="cartao_credito"),o(X,"type","button"),o(X,"class","btn-secondary"),o(X,"aria-pressed",Le=l[2]==="pix"),o(C,"class","flex flex-wrap gap-2"),o(ne,"type","checkbox"),o(ye,"class","inline-flex items-center gap-2 text-sm dark:text-gray-200"),o(qe,"type","button"),o(qe,"class","btn-secondary"),o(Y,"type","button"),o(Y,"class","btn-primary"),Y.disabled=l[14],o(Ae,"class","flex justify-end gap-2 pt-2"),o(n,"class","space-y-4"),o(e,"class","modal-content text-gray-900 dark:text-gray-100"),o(e,"role","dialog"),o(e,"aria-modal","true"),o(e,"aria-labelledby","titulo-pagamento"),o(t,"class","modal-backdrop"),o(t,"role","button"),o(t,"tabindex","0"),o(t,"aria-label","Fechar modal de pagamento")},m(de,xe){fe(de,t,xe),a(t,e),a(e,r),a(e,y),a(e,n),a(n,p),a(p,u),a(p,v),a(p,h),a(h,b),a(h,q),a(n,A),a(n,R),a(R,w),a(w,k),a(w,V),a(w,C),a(C,L),a(L,P),a(C,F),a(C,W),a(W,j),a(C,B),a(C,S),a(S,z),a(C,J),a(C,X),a(X,je),a(n,Ie),a(n,ye),a(ye,ne),ne.checked=l[16],a(ye,Ve),a(n,Qe),se&&se.m(n,null),a(n,ke),ie&&ie.m(n,null),a(n,Ce),a(n,Ae),a(Ae,qe),a(Ae,pe),a(Ae,Y),a(Y,Re),_e||(Ze=[G(L,"click",l[59]),G(W,"click",l[60]),G(S,"click",l[61]),G(X,"click",l[62]),G(ne,"change",l[63]),G(qe,"click",l[65]),G(Y,"click",l[42]),G(t,"keydown",l[66]),G(t,"click",Et(l[67]))],_e=!0)},p(de,xe){xe[0]&16&&c!==(c=Number(de[4]).toFixed(2)+"")&&Oe(q,c),xe[0]&4&&te!==(te=de[2]==="dinheiro")&&o(L,"aria-pressed",te),xe[0]&4&&Q!==(Q=de[2]==="cartao_debito")&&o(W,"aria-pressed",Q),xe[0]&4&&me!==(me=de[2]==="cartao_credito")&&o(S,"aria-pressed",me),xe[0]&4&&Le!==(Le=de[2]==="pix")&&o(X,"aria-pressed",Le),xe[0]&65536&&(ne.checked=de[16]),de[2]==="dinheiro"?se?se.p(de,xe):(se=jt(de),se.c(),se.m(n,ke)):se&&(se.d(1),se=null),de[15]?ie?ie.p(de,xe):(ie=zt(de),ie.c(),ie.m(n,Ce)):ie&&(ie.d(1),ie=null),xe[0]&81920&&he!==(he=de[14]?"Salvando...":de[16]?"Confirmar e imprimir":"Confirmar venda")&&Oe(Re,he),xe[0]&16384&&(Y.disabled=de[14])},d(de){de&&d(t),se&&se.d(),ie&&ie.d(),_e=!1,ft(Ze)}}}function jt(l){let t,e,r,m="Valor Recebido (R$)",y,n,p,u,N,v="Troco",h,b,c,q=Number(l[29]).toFixed(2)+"",A,R,w;return{c(){t=i("div"),e=i("div"),r=i("label"),r.textContent=m,y=T(),n=i("input"),p=T(),u=i("div"),N=i("div"),N.textContent=v,h=T(),b=i("div"),c=re("R$ "),A=re(q),this.h()},l(k){t=s(k,"DIV",{class:!0});var x=g(t);e=s(x,"DIV",{});var V=g(e);r=s(V,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),K(r)!=="svelte-hw4qr4"&&(r.textContent=m),y=I(V),n=s(V,"INPUT",{id:!0,type:!0,min:!0,step:!0,class:!0}),V.forEach(d),p=I(x),u=s(x,"DIV",{});var C=g(u);N=s(C,"DIV",{class:!0,"data-svelte-h":!0}),K(N)!=="svelte-1elrc5i"&&(N.textContent=v),h=I(C),b=s(C,"DIV",{class:!0});var L=g(b);c=le(L,"R$ "),A=le(L,q),L.forEach(d),C.forEach(d),x.forEach(d),this.h()},h(){o(r,"for","valor-recebido"),o(r,"class","block text-sm font-medium text-gray-800 dark:text-gray-200 mb-1"),o(n,"id","valor-recebido"),o(n,"type","number"),o(n,"min","0"),o(n,"step","0.01"),o(n,"class","input-form"),o(N,"class","text-sm text-gray-600 dark:text-gray-300 mb-1"),o(b,"class","text-xl font-semibold dark:text-gray-100"),o(t,"class","grid grid-cols-1 sm:grid-cols-2 gap-4 items-end")},m(k,x){fe(k,t,x),a(t,e),a(e,r),a(e,y),a(e,n),Ye(n,l[3]),a(t,p),a(t,u),a(u,N),a(u,h),a(u,b),a(b,c),a(b,A),R||(w=G(n,"input",l[64]),R=!0)},p(k,x){x[0]&8&&lt(n.value)!==k[3]&&Ye(n,k[3]),x[0]&536870912&&q!==(q=Number(k[29]).toFixed(2)+"")&&Oe(A,q)},d(k){k&&d(t),R=!1,w()}}}function zt(l){let t,e;return{c(){t=i("div"),e=re(l[15]),this.h()},l(r){t=s(r,"DIV",{class:!0});var m=g(t);e=le(m,l[15]),m.forEach(d),this.h()},h(){o(t,"class","text-sm text-red-600")},m(r,m){fe(r,t,m),a(t,e)},p(r,m){m[0]&32768&&Oe(e,r[15])},d(r){r&&d(t)}}}function Ht(l){let t,e,r,m="Movimentar Caixa",y,n,p,u,N,v="Tipo de movimentação",h,b,c,q,A,R,w,k,x,V,C,L,P="Valor (R$)",te,F,W,j,Q,B="Motivo/observação (opcional)",S,z,me,J,X,je,Le,Ie,ye,ne,Ve="Cancelar",Qe,ke,Ce=l[22]?"Registrando...":"Confirmar",Ae,qe,Se,pe=l[23]&&Qt(l);return{c(){t=i("div"),e=i("div"),r=i("h3"),r.textContent=m,y=T(),n=i("div"),p=i("div"),u=i("fieldset"),N=i("legend"),N.textContent=v,h=T(),b=i("div"),c=i("button"),q=re("Entrada"),R=T(),w=i("button"),k=re("Saída"),V=T(),C=i("div"),L=i("label"),L.textContent=P,te=T(),F=i("input"),W=T(),j=i("div"),Q=i("label"),Q.textContent=B,S=T(),z=i("input"),me=T(),J=i("label"),X=i("input"),je=re(" Imprimir recibo"),Le=T(),pe&&pe.c(),Ie=T(),ye=i("div"),ne=i("button"),ne.textContent=Ve,Qe=T(),ke=i("button"),Ae=re(Ce),this.h()},l(Y){t=s(Y,"DIV",{class:!0,role:!0,tabindex:!0,"aria-label":!0});var he=g(t);e=s(he,"DIV",{class:!0,role:!0,"aria-modal":!0,"aria-labelledby":!0});var Re=g(e);r=s(Re,"H3",{id:!0,class:!0,"data-svelte-h":!0}),K(r)!=="svelte-50zv8y"&&(r.textContent=m),y=I(Re),n=s(Re,"DIV",{class:!0});var _e=g(n);p=s(_e,"DIV",{});var Ze=g(p);u=s(Ze,"FIELDSET",{});var se=g(u);N=s(se,"LEGEND",{class:!0,"data-svelte-h":!0}),K(N)!=="svelte-1pm0gkm"&&(N.textContent=v),h=I(se),b=s(se,"DIV",{class:!0});var ie=g(b);c=s(ie,"BUTTON",{type:!0,class:!0,"aria-pressed":!0});var de=g(c);q=le(de,"Entrada"),de.forEach(d),R=I(ie),w=s(ie,"BUTTON",{type:!0,class:!0,"aria-pressed":!0});var xe=g(w);k=le(xe,"Saída"),xe.forEach(d),ie.forEach(d),se.forEach(d),Ze.forEach(d),V=I(_e),C=s(_e,"DIV",{});var Ge=g(C);L=s(Ge,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),K(L)!=="svelte-1ds600e"&&(L.textContent=P),te=I(Ge),F=s(Ge,"INPUT",{id:!0,type:!0,min:!0,step:!0,class:!0}),Ge.forEach(d),W=I(_e),j=s(_e,"DIV",{});var ve=g(j);Q=s(ve,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),K(Q)!=="svelte-17hz9zr"&&(Q.textContent=B),S=I(ve),z=s(ve,"INPUT",{id:!0,type:!0,maxlength:!0,class:!0,placeholder:!0}),ve.forEach(d),me=I(_e),J=s(_e,"LABEL",{class:!0});var Ee=g(J);X=s(Ee,"INPUT",{type:!0}),je=le(Ee," Imprimir recibo"),Ee.forEach(d),Le=I(_e),pe&&pe.l(_e),Ie=I(_e),ye=s(_e,"DIV",{class:!0});var ze=g(ye);ne=s(ze,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),K(ne)!=="svelte-gbngz2"&&(ne.textContent=Ve),Qe=I(ze),ke=s(ze,"BUTTON",{type:!0,class:!0});var et=g(ke);Ae=le(et,Ce),et.forEach(d),ze.forEach(d),_e.forEach(d),Re.forEach(d),he.forEach(d),this.h()},h(){o(r,"id","titulo-movcaixa"),o(r,"class","text-lg font-medium leading-6 text-gray-900 dark:text-gray-100 mb-4"),o(N,"class","block text-sm font-medium text-gray-800 dark:text-gray-200 mb-1"),o(c,"type","button"),o(c,"class","btn-secondary"),o(c,"aria-pressed",A=l[18]==="entrada"),o(w,"type","button"),o(w,"class","btn-secondary"),o(w,"aria-pressed",x=l[18]==="saida"),o(b,"class","flex gap-2"),o(L,"for","valor-mov"),o(L,"class","block text-sm font-medium text-gray-800 dark:text-gray-200 mb-1"),o(F,"id","valor-mov"),o(F,"type","number"),o(F,"min","0.01"),o(F,"step","0.01"),o(F,"class","input-form"),o(Q,"for","motivo-mov"),o(Q,"class","block text-sm font-medium text-gray-800 dark:text-gray-200 mb-1"),o(z,"id","motivo-mov"),o(z,"type","text"),o(z,"maxlength","140"),o(z,"class","input-form"),o(z,"placeholder","Ex.: Retirada para cofre / Troco adicional"),o(X,"type","checkbox"),o(J,"class","inline-flex items-center gap-2 text-sm dark:text-gray-200"),o(ne,"type","button"),o(ne,"class","btn-secondary"),o(ke,"type","button"),o(ke,"class","btn-primary"),ke.disabled=l[22],o(ye,"class","flex justify-end gap-2 pt-2"),o(n,"class","space-y-4"),o(e,"class","modal-content text-gray-900 dark:text-gray-100"),o(e,"role","dialog"),o(e,"aria-modal","true"),o(e,"aria-labelledby","titulo-movcaixa"),o(t,"class","modal-backdrop"),o(t,"role","button"),o(t,"tabindex","0"),o(t,"aria-label","Fechar modal de movimentação de caixa")},m(Y,he){fe(Y,t,he),a(t,e),a(e,r),a(e,y),a(e,n),a(n,p),a(p,u),a(u,N),a(u,h),a(u,b),a(b,c),a(c,q),a(b,R),a(b,w),a(w,k),a(n,V),a(n,C),a(C,L),a(C,te),a(C,F),Ye(F,l[19]),a(n,W),a(n,j),a(j,Q),a(j,S),a(j,z),Ye(z,l[20]),a(n,me),a(n,J),a(J,X),X.checked=l[21],a(J,je),a(n,Le),pe&&pe.m(n,null),a(n,Ie),a(n,ye),a(ye,ne),a(ye,Qe),a(ye,ke),a(ke,Ae),qe||(Se=[G(c,"click",l[68]),G(w,"click",l[69]),G(F,"input",l[70]),G(z,"input",l[71]),G(X,"change",l[72]),G(ne,"click",l[73]),G(ke,"click",l[37]),G(t,"keydown",l[74]),G(t,"click",Et(l[75]))],qe=!0)},p(Y,he){he[0]&262144&&A!==(A=Y[18]==="entrada")&&o(c,"aria-pressed",A),he[0]&262144&&x!==(x=Y[18]==="saida")&&o(w,"aria-pressed",x),he[0]&524288&&lt(F.value)!==Y[19]&&Ye(F,Y[19]),he[0]&1048576&&z.value!==Y[20]&&Ye(z,Y[20]),he[0]&2097152&&(X.checked=Y[21]),Y[23]?pe?pe.p(Y,he):(pe=Qt(Y),pe.c(),pe.m(n,Ie)):pe&&(pe.d(1),pe=null),he[0]&4194304&&Ce!==(Ce=Y[22]?"Registrando...":"Confirmar")&&Oe(Ae,Ce),he[0]&4194304&&(ke.disabled=Y[22])},d(Y){Y&&d(t),pe&&pe.d(),qe=!1,ft(Se)}}}function Qt(l){let t,e;return{c(){t=i("div"),e=re(l[23]),this.h()},l(r){t=s(r,"DIV",{class:!0});var m=g(t);e=le(m,l[23]),m.forEach(d),this.h()},h(){o(t,"class","text-sm text-red-600")},m(r,m){fe(r,t,m),a(t,e)},p(r,m){m[0]&8388608&&Oe(e,r[23])},d(r){r&&d(t)}}}function no(l){let t,e,r,m="Saldo em caixa (dinheiro):",y,n,p,u=Number(l[27]).toFixed(2)+"",N,v,h,b,c,q,A,R='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 mx-auto"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75"></path></svg>',w,k=[],x=new qt,V,C,L,P,te,F='<h2 class="text-xl font-bold text-gray-900">Comanda</h2>',W,j,Q,B,S,z,me="Total:",J,X,je,Le=Number(l[4]).toFixed(2)+"",Ie,ye,ne,Ve,Qe="Movimentar Caixa",ke,Ce,Ae="Limpar",qe,Se,pe,Y,he,Re,_e,Ze,se,ie,de,xe;function Ge(_,H){return _[28]?to:eo}let ve=Ge(l),Ee=ve(l),ze=gt(l[5]);const et=_=>_[90].id;for(let _=0;_<ze.length;_+=1){let H=Rt(l,ze,_),Je=et(H);x.set(Je,k[_]=Pt(Je,H))}function rt(_,H){return _[6]?ao:oo}let He=rt(l),Be=He(l);function ct(_,H){return _[1].length===0?ro:lo}let nt=ct(l),Fe=nt(l),Ne=l[25]&&St(l),we=l[7]&&Mt(l),Te=l[10]&&Ft(l),Pe=l[13]&&Ot(l),Ue=l[17]&&Ht(l);return{c(){t=i("div"),e=i("div"),r=i("span"),r.textContent=m,y=T(),n=i("span"),p=re("R$ "),N=re(u),v=T(),h=i("div"),Ee.c(),b=T(),c=i("div"),q=i("nav"),A=i("a"),A.innerHTML=R,w=T();for(let _=0;_<k.length;_+=1)k[_].c();V=T(),C=i("main"),Be.c(),L=T(),P=i("aside"),te=i("div"),te.innerHTML=F,W=T(),j=i("div"),Fe.c(),Q=T(),B=i("div"),S=i("div"),z=i("span"),z.textContent=me,J=T(),X=i("span"),je=re("R$ "),Ie=re(Le),ye=T(),ne=i("div"),Ve=i("button"),Ve.textContent=Qe,ke=T(),Ce=i("button"),Ce.textContent=Ae,qe=T(),Se=i("button"),pe=re("Finalizar Venda"),he=T(),Ne&&Ne.c(),Re=T(),we&&we.c(),_e=T(),Te&&Te.c(),Ze=T(),Pe&&Pe.c(),se=T(),Ue&&Ue.c(),ie=Dt(),this.h()},l(_){t=s(_,"DIV",{class:!0});var H=g(t);e=s(H,"DIV",{class:!0});var Je=g(e);r=s(Je,"SPAN",{class:!0,"data-svelte-h":!0}),K(r)!=="svelte-1ibi9dw"&&(r.textContent=m),y=I(Je),n=s(Je,"SPAN",{class:!0});var yt=g(n);p=le(yt,"R$ "),N=le(yt,u),yt.forEach(d),Je.forEach(d),v=I(H),h=s(H,"DIV",{class:!0});var wt=g(h);Ee.l(wt),wt.forEach(d),H.forEach(d),b=I(_),c=s(_,"DIV",{class:!0});var dt=g(c);q=s(dt,"NAV",{class:!0});var mt=g(q);A=s(mt,"A",{href:!0,class:!0,title:!0,"data-svelte-h":!0}),K(A)!=="svelte-1pqlors"&&(A.innerHTML=R),w=I(mt);for(let U=0;U<k.length;U+=1)k[U].l(mt);mt.forEach(d),V=I(dt),C=s(dt,"MAIN",{class:!0});var kt=g(C);Be.l(kt),kt.forEach(d),L=I(dt),P=s(dt,"ASIDE",{class:!0});var ut=g(P);te=s(ut,"DIV",{class:!0,"data-svelte-h":!0}),K(te)!=="svelte-12d8jky"&&(te.innerHTML=F),W=I(ut),j=s(ut,"DIV",{class:!0});var Ct=g(j);Fe.l(Ct),Ct.forEach(d),Q=I(ut),B=s(ut,"DIV",{class:!0});var pt=g(B);S=s(pt,"DIV",{class:!0});var ht=g(S);z=s(ht,"SPAN",{class:!0,"data-svelte-h":!0}),K(z)!=="svelte-9ihq1s"&&(z.textContent=me),J=I(ht),X=s(ht,"SPAN",{class:!0});var xt=g(X);je=le(xt,"R$ "),Ie=le(xt,Le),xt.forEach(d),ht.forEach(d),ye=I(pt),ne=s(pt,"DIV",{class:!0});var f=g(ne);Ve=s(f,"BUTTON",{class:!0,"data-svelte-h":!0}),K(Ve)!=="svelte-y8j643"&&(Ve.textContent=Qe),ke=I(f),Ce=s(f,"BUTTON",{class:!0,"data-svelte-h":!0}),K(Ce)!=="svelte-wi7rjs"&&(Ce.textContent=Ae),qe=I(f),Se=s(f,"BUTTON",{class:!0});var E=g(Se);pe=le(E,"Finalizar Venda"),E.forEach(d),f.forEach(d),pt.forEach(d),ut.forEach(d),dt.forEach(d),he=I(_),Ne&&Ne.l(_),Re=I(_),we&&we.l(_),_e=I(_),Te&&Te.l(_),Ze=I(_),Pe&&Pe.l(_),se=I(_),Ue&&Ue.l(_),ie=Dt(),this.h()},h(){o(r,"class","font-medium"),o(n,"class","ml-1 text-green-700 font-semibold"),o(e,"class","text-sm text-gray-700"),o(h,"class","text-xs text-gray-500 flex items-center gap-2"),o(t,"class","w-full px-4 py-2 mb-2 bg-white border-b border-gray-200 flex items-center justify-between shadow-sm"),o(A,"href","/admin"),o(A,"class","block p-4 text-center hover:bg-gray-700"),o(A,"title","Painel Admin"),o(q,"class","w-24 bg-gray-800 text-white flex-shrink-0 overflow-y-auto"),o(C,"class","flex-1 p-4 overflow-y-auto"),o(te,"class","p-4 border-b"),o(j,"class","flex-1 p-4 overflow-y-auto"),o(z,"class","text-lg font-medium text-gray-700"),o(X,"class","text-3xl font-bold text-gray-900"),o(S,"class","flex justify-between items-center"),o(Ve,"class","w-full py-3 bg-amber-100 text-amber-800 font-medium rounded-md hover:bg-amber-200 transition-colors"),o(Ce,"class","w-full py-3 bg-red-100 text-red-700 font-medium rounded-md hover:bg-red-200 transition-colors"),Se.disabled=Y=!l[24]||l[1].length===0,o(Se,"class","w-full py-3 bg-green-600 text-white font-bold rounded-md hover:bg-green-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed"),o(ne,"class","flex space-x-2"),o(B,"class","p-4 border-t bg-gray-50 space-y-4"),o(P,"class","w-80 lg:w-96 bg-white flex-shrink-0 flex flex-col shadow-lg"),o(c,"class","flex w-full min-h-[70vh] bg-transparent overflow-hidden")},m(_,H){fe(_,t,H),a(t,e),a(e,r),a(e,y),a(e,n),a(n,p),a(n,N),a(t,v),a(t,h),Ee.m(h,null),fe(_,b,H),fe(_,c,H),a(c,q),a(q,A),a(q,w);for(let Je=0;Je<k.length;Je+=1)k[Je]&&k[Je].m(q,null);a(c,V),a(c,C),Be.m(C,null),a(c,L),a(c,P),a(P,te),a(P,W),a(P,j),Fe.m(j,null),a(P,Q),a(P,B),a(B,S),a(S,z),a(S,J),a(S,X),a(X,je),a(X,Ie),a(B,ye),a(B,ne),a(ne,Ve),a(ne,ke),a(ne,Ce),a(ne,qe),a(ne,Se),a(Se,pe),fe(_,he,H),Ne&&Ne.m(_,H),fe(_,Re,H),we&&we.m(_,H),fe(_,_e,H),Te&&Te.m(_,H),fe(_,Ze,H),Pe&&Pe.m(_,H),fe(_,se,H),Ue&&Ue.m(_,H),fe(_,ie,H),de||(xe=[G(Ve,"click",l[36]),G(Ce,"click",l[35]),G(Se,"click",l[41])],de=!0)},p(_,H){H[0]&134217728&&u!==(u=Number(_[27]).toFixed(2)+"")&&Oe(N,u),ve===(ve=Ge(_))&&Ee?Ee.p(_,H):(Ee.d(1),Ee=ve(_),Ee&&(Ee.c(),Ee.m(h,null))),H[0]&33&&(ze=gt(_[5]),k=It(k,H,et,1,_,ze,x,q,Tt,Pt,null,Rt)),He===(He=rt(_))&&Be?Be.p(_,H):(Be.d(1),Be=He(_),Be&&(Be.c(),Be.m(C,null))),nt===(nt=ct(_))&&Fe?Fe.p(_,H):(Fe.d(1),Fe=nt(_),Fe&&(Fe.c(),Fe.m(j,null))),H[0]&16&&Le!==(Le=Number(_[4]).toFixed(2)+"")&&Oe(Ie,Le),H[0]&16777218&&Y!==(Y=!_[24]||_[1].length===0)&&(Se.disabled=Y),_[25]?Ne?Ne.p(_,H):(Ne=St(_),Ne.c(),Ne.m(Re.parentNode,Re)):Ne&&(Ne.d(1),Ne=null),_[7]?we?we.p(_,H):(we=Mt(_),we.c(),we.m(_e.parentNode,_e)):we&&(we.d(1),we=null),_[10]?Te?Te.p(_,H):(Te=Ft(_),Te.c(),Te.m(Ze.parentNode,Ze)):Te&&(Te.d(1),Te=null),_[13]?Pe?Pe.p(_,H):(Pe=Ot(_),Pe.c(),Pe.m(se.parentNode,se)):Pe&&(Pe.d(1),Pe=null),_[17]?Ue?Ue.p(_,H):(Ue=Ht(_),Ue.c(),Ue.m(ie.parentNode,ie)):Ue&&(Ue.d(1),Ue=null)},i:vt,o:vt,d(_){_&&(d(t),d(b),d(c),d(he),d(Re),d(_e),d(Ze),d(se),d(ie)),Ee.d();for(let H=0;H<k.length;H+=1)k[H].d();Be.d(),Fe.d(),Ne&&Ne.d(_),we&&we.d(_),Te&&Te.d(_),Pe&&Pe.d(_),Ue&&Ue.d(_),de=!1,ft(xe)}}}function so(l,t,e){let r,m,y,n=[],p=[],u=null,N=!0,v=[],h=!1,b=null,c=1,q=!1,A=0,R="Item Avulso",w=!1,k=null,x=0,V=!1,C="",L=!1,P=!1,te="saida",F=0,W="",j=!0,Q=!1,B="",S=!0,z=!1,me=0,J=null,X=0,je=!1;Gt(async()=>{var $,ae,ge;if(!await Yt({requireProfile:!0})||!be)return;console.groupCollapsed("[AuthDebug] /app onMount");const E=(ee=4e3)=>Promise.race([be.auth.getSession(),new Promise(O=>setTimeout(()=>O({data:{session:null},error:null}),ee))]);console.time("[AuthDebug] getSession (/app)");const{data:U}=await E(4e3);if(console.timeEnd("[AuthDebug] getSession (/app)"),console.log("[AuthDebug] /app getSession result",{hasSession:!!(U!=null&&U.session),userId:((ae=($=U==null?void 0:U.session)==null?void 0:$.user)==null?void 0:ae.id)||null}),(ge=U==null?void 0:U.session)!=null&&ge.user)await Le(U.session.user.id),await ye(),await ne(),await Ie(),e(6,N=!1);else{console.log("[AuthDebug] /app: no session -> redirect /login"),window.location.href="/login";return}be.auth.onAuthStateChange(async(ee,O)=>{var Me;console.log("[AuthDebug] /app onAuthStateChange",{hasSession:!!O,userId:((Me=O==null?void 0:O.user)==null?void 0:Me.id)||null}),O!=null&&O.user?(await Le(O.user.id),await ye(),await ne(),await Ie(),e(6,N=!1)):(console.log("[AuthDebug] /app: logout detected -> redirect /login"),window.location.href="/login")}),console.groupEnd()});async function Le(f){const{data:E,error:U}=await be.from("caixas").select("id, data_abertura, data_fechamento").eq("id_usuario",f).is("data_fechamento",null).order("data_abertura",{ascending:!1}).limit(1);if(U){console.error("Erro ao verificar caixa:",U.message),e(24,S=!1),e(25,z=!0),J=null;return}E&&E.length>0?(e(24,S=!0),e(25,z=!1),J=E[0].id):(e(24,S=!1),e(25,z=!0),J=null)}async function Ie(){try{if(!S||!J){e(27,X=0);return}e(28,je=!0);const f=be.from("caixas").select("valor_inicial").eq("id",J).single(),E=be.from("vendas").select("valor_total").eq("id_caixa",J).eq("forma_pagamento","dinheiro"),U=be.from("caixa_movimentacoes").select("valor, tipo").eq("id_caixa",J),[{data:$,error:ae},{data:ge,error:ee},{data:O,error:Me}]=await Promise.all([f,E,U]);if(ae)throw ae;if(ee)throw ee;if(Me)throw Me;const Xe=Number(($==null?void 0:$.valor_inicial)||0),st=Array.isArray(ge)?ge.reduce((De,D)=>De+Number((D==null?void 0:D.valor_total)||0),0):0;let tt=0,ot=0;if(Array.isArray(O))for(const De of O){const D=Number((De==null?void 0:De.valor)||0);(De==null?void 0:De.tipo)==="sangria"?tt+=D:(De==null?void 0:De.tipo)==="suprimento"&&(ot+=D)}e(27,X=Xe+st-tt+ot)}catch(f){console.warn("Falha ao atualizar saldo do caixa:",(f==null?void 0:f.message)||f)}finally{e(28,je=!1)}}async function ye(){const{data:f,error:E}=await be.from("categorias").select("*").order("ordem",{ascending:!0});E?E.message:(e(5,p=f),f.length>0&&e(0,u=f[0].id))}async function ne(){const{data:f,error:E}=await be.from("produtos").select("*").eq("ocultar_no_pdv",!1).order("nome",{ascending:!0});E?E.message:e(43,n=f)}function Ve(f){if(!S){e(25,z=!0);return}if(f!=null&&f.eh_item_por_unidade){e(8,b=f),e(9,c=1),e(7,h=!0);return}if(f!=null&&f.id&&(f!=null&&f.controlar_estoque)){const E=v.find(ae=>ae.id_produto===f.id),U=(E==null?void 0:E.quantidade)||0,$=Number(f.estoque_atual||0);if(U+1>$){alert(`Estoque insuficiente para "${f.nome}". Restam ${$} unidade(s).`);return}}Qe(f,1,f.preco)}function Qe(f,E,U){const $=f.id??Date.now(),ae=v.find(ge=>ge.id===$);ae?(ae.quantidade+=E,e(1,v=[...v])):e(1,v=[...v,{id:$,id_produto:f.id||null,nome:f.nome,preco:U,quantidade:E}]),e(10,q=!1)}function ke(f){const E=v.find(U=>U.id===f);if(E){if(E.id_produto){const U=n.find($=>$.id===E.id_produto);if(U!=null&&U.controlar_estoque){const $=Number(U.estoque_atual||0);if(E.quantidade+1>$){alert(`Estoque insuficiente para "${E.nome}". Restam ${$} unidade(s).`);return}}}E.quantidade++,e(1,v=[...v])}}function Ce(f){const E=v.find(U=>U.id===f);E&&(E.quantidade--,E.quantidade<=0?e(1,v=v.filter(U=>U.id!==f)):e(1,v=[...v]))}function Ae(){confirm("Limpar toda a comanda?")&&e(1,v=[])}function qe(){if(!S){e(25,z=!0);return}e(18,te="saida"),e(19,F=0),e(20,W=""),e(23,B=""),e(22,Q=!1),e(17,P=!0)}async function Se(){var f;try{if(e(23,B=""),!S||!J){e(23,B="É necessário um caixa aberto.");return}const E=Number(F);if(!Number.isFinite(E)||E<=0){e(23,B="Informe um valor válido (maior que 0).");return}if(await Ie(),te==="saida"&&E>Number(X||0)){e(23,B=`Valor maior que o saldo em caixa (R$ ${Number(X).toFixed(2)}).`);return}e(22,Q=!0);const{data:U}=await be.auth.getUser(),$=((f=U==null?void 0:U.user)==null?void 0:f.id)??null;if(!$)throw new Error("Sessão inválida. Faça login novamente.");const{data:ae,error:ge}=await be.from("caixa_movimentacoes").insert({id_caixa:J,id_usuario:$,tipo:te==="saida"?"sangria":"suprimento",valor:E,motivo:W||null}).select("id, created_at").single();if(ge)throw new Error(ge.message);const ee={idMov:ae==null?void 0:ae.id,idCaixa:J,tipo:te,valor:E,motivo:W||null,created_at:ae==null?void 0:ae.created_at};if(e(17,P=!1),j)try{await se(ee)}catch(O){console.warn("Falha ao imprimir recibo de movimentação:",(O==null?void 0:O.message)||O)}alert("Movimentação registrada com sucesso."),await Ie()}catch(E){e(23,B=(E==null?void 0:E.message)||"Falha ao registrar a movimentação.")}finally{e(22,Q=!1)}}async function pe(){var ae;if(me<0)return;const{data:f}=await be.auth.getUser(),E=((ae=f==null?void 0:f.user)==null?void 0:ae.id)??null;if(!E){alert("Sessão inválida. Faça login novamente.");return}const{data:U,error:$}=await be.from("caixas").insert({data_abertura:new Date().toISOString(),valor_inicial:Number(me),id_usuario:E}).select("id").single();if($){alert("Erro ao abrir caixa: "+$.message);return}J=U.id,e(24,S=!0),e(25,z=!1),await Ie()}function Y(){A<=0||(Qe({id:null,nome:R||"Item Avulso"},1,A),e(11,A=0),e(12,R="Item Avulso"))}function he(){const f=b;if(!f)return;const E=Number(c),U=Math.floor(E);if(!(!Number.isFinite(E)||U<=0)){if(f.id&&f.controlar_estoque){const $=v.find(ee=>ee.id_produto===f.id),ae=($==null?void 0:$.quantidade)||0,ge=Number(f.estoque_atual||0);if(U+ae>ge){alert(`Estoque insuficiente para "${f.nome}". Restam ${ge} unidade(s).`);return}}Qe(f,U,f.preco),e(7,h=!1),e(8,b=null),e(9,c=1)}}function Re(){if(v.length===0){alert("A comanda está vazia.");return}e(13,w=!0),e(2,k=null),e(3,x=0),e(15,C=""),e(14,V=!1)}async function _e(){var f;try{if(e(15,C=""),!k){e(15,C="Selecione a forma de pagamento.");return}if(k==="dinheiro"&&Number(x)<Number(m)){e(15,C="Valor recebido insuficiente para cobrir o total.");return}if(v.length===0){e(15,C="A comanda está vazia.");return}e(14,V=!0);let E=null;if(L)try{E=window.open("","_blank","width=320,height=600"),E&&(E.document.open(),E.document.write(`<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Recibo</title></head><body style="font-family:sans-serif;padding:12px;font-size:12px;">Preparando recibo...<script>
window.addEventListener('message', function(e){
  try {
    if (e && e.data && e.data.type === 'RECIBO_HTML' && typeof e.data.html === 'string') {
      document.open();
      document.write(e.data.html);
      document.close();
    }
  } catch(err){ console.warn('[ReciboPlaceholder] replace via postMessage falhou:', (err && err.message) || err); }
});
<\/script></body></html>`),E.document.close())}catch(D){console.warn("Popup de impressão bloqueado ou falhou ao abrir:",(D==null?void 0:D.message)||D),E=null}const{data:U}=await be.auth.getUser(),$=((f=U==null?void 0:U.user)==null?void 0:f.id)??null;try{const D=[...new Set(v.filter(ce=>ce.id_produto).map(ce=>ce.id_produto))];if(D.length){const{data:ce,error:at}=await be.from("produtos").select("id, nome, controlar_estoque, estoque_atual").in("id",D);if(!at&&ce){const it=new Map(ce.map(M=>[M.id,M])),We=M=>{if(M!=null&&M.id_produto&&typeof(M==null?void 0:M.nome)=="string"){const ue=M.nome.match(/^(\d+)x\s/i);if(ue)return parseInt(ue[1],10)}return M.quantidade||1},Z=new Map;for(const M of v){if(!M.id_produto)continue;const ue=We(M);Z.set(M.id_produto,(Z.get(M.id_produto)||0)+Number(ue))}const oe=[];for(const[M,ue]of Z.entries()){const Ke=it.get(M);if(Ke!=null&&Ke.controlar_estoque){const bt=Number(Ke.estoque_atual||0);ue>bt&&oe.push(`${Ke.nome} (disp: ${bt}, ped: ${ue})`)}}if(oe.length){e(15,C=`Estoque insuficiente para: ${oe.join(", ")}`),e(14,V=!1);return}}}}catch(D){console.warn("Falha ao validar estoque pré-venda (prossegue):",(D==null?void 0:D.message)||D)}const{data:ae,error:ge}=await be.from("vendas").insert({valor_total:Number(m),forma_pagamento:k,valor_recebido:k==="dinheiro"?Number(x):null,valor_troco:k==="dinheiro"?Number(y):0,id_usuario:$,id_caixa:J}).select("id").single();if(ge)throw new Error(ge.message);const ee=D=>{if(D!=null&&D.id_produto&&typeof(D==null?void 0:D.nome)=="string"){const ce=D.nome.match(/^(\d+)x\s/i);if(ce)return parseInt(ce[1],10)}return D.quantidade||1},O=v.map(D=>{const ce=ee(D),at=Number(D.preco);return{id_usuario:$,id_venda:ae.id,id_produto:D.id_produto??null,quantidade:ce,nome_produto_na_venda:D.nome,preco_unitario_na_venda:Number(at)}}),{error:Me}=await be.from("vendas_itens").insert(O);if(Me)throw await be.from("vendas").delete().eq("id",ae.id),new Error(Me.message);try{const D=[...new Set(v.filter(ce=>ce.id_produto).map(ce=>ce.id_produto))];if(D.length){const{data:ce,error:at}=await be.from("produtos").select("id, controlar_estoque, estoque_atual").in("id",D);if(!at&&ce){const it=new Map(ce.map(oe=>[oe.id,oe])),We=new Map;for(const oe of v){if(!oe.id_produto)continue;const M=ee(oe);We.set(oe.id_produto,(We.get(oe.id_produto)||0)+Number(M))}const Z=[];for(const[oe,M]of We.entries()){const ue=it.get(oe);if(ue!=null&&ue.controlar_estoque){const Ke=Number(ue.estoque_atual||0)-Number(M||0);Z.push(be.from("produtos").update({estoque_atual:Ke}).eq("id",oe))}}Promise.allSettled(Z).then(oe=>{const M=oe.filter(ue=>ue.status==="rejected");M.length&&console.warn("Algumas baixas de estoque falharam.",M.length)})}}}catch(D){console.warn("Falha ao baixar estoque (MVP continua):",(D==null?void 0:D.message)||D)}const Xe=k,st=x,tt=Xe==="dinheiro"?Number(y):0,ot=Number(m),De=O;if(e(13,w=!1),e(1,v=[]),e(2,k=null),e(3,x=0),await Ie(),L){const D={idVenda:ae.id,formaPagamento:Xe,total:ot,valorRecebido:Xe==="dinheiro"?Number(st):null,troco:tt,itens:De};setTimeout(()=>{try{Ze(D,E)}catch(ce){console.warn("Falha ao imprimir recibo:",(ce==null?void 0:ce.message)||ce)}},60)}}catch(E){e(15,C=(E==null?void 0:E.message)??"Erro ao salvar a venda.")}finally{e(14,V=!1)}}async function Ze({idVenda:f,formaPagamento:E,total:U,valorRecebido:$,troco:ae,itens:ge},ee=null){var ce,at,it,We;console.groupCollapsed("%c[Recibo] imprimirReciboVenda","color:#0a7"),console.log("[Recibo] params:",{idVenda:f,formaPagamento:E,total:U,valorRecebido:$,troco:ae,itensCount:(ge==null?void 0:ge.length)||0});let O=null,Me=null,Xe="80mm";const st=(Z,oe,M="op")=>Promise.race([Z,new Promise(ue=>setTimeout(()=>ue({__timeout:!0,label:M}),oe))]);try{console.time("[Recibo] getUser");const Z=await st(be.auth.getUser(),800,"getUser");if(console.timeEnd("[Recibo] getUser"),Z!=null&&Z.__timeout)console.warn("[Recibo] getUser timeout — seguindo com defaults");else{const oe=(at=(ce=Z==null?void 0:Z.data)==null?void 0:ce.user)==null?void 0:at.id;if(console.log("[Recibo] userId:",oe),oe){console.time("[Recibo] fetch perfil");const M=await st(be.from("empresa_perfil").select("*").eq("user_id",oe).limit(1).single(),800,"perfil");if(console.timeEnd("[Recibo] fetch perfil"),!(M!=null&&M.__timeout)&&!(M!=null&&M.error)){if(O=M.data,Xe=(O==null?void 0:O.largura_bobina)||"80mm",console.log("[Recibo] perfil carregado:",O),O.logo_url)Me=O.logo_url;else{const ue=be.storage.from("logos").getPublicUrl(`${oe}.png`);Me=((it=ue==null?void 0:ue.data)==null?void 0:it.publicUrl)||null}console.log("[Recibo] logoUrl:",Me)}else console.warn("[Recibo] perfil não carregado (timeout/erro):",((We=M==null?void 0:M.error)==null?void 0:We.message)||(M==null?void 0:M.label)||"timeout")}else console.warn("[Recibo] Sem userId — perfil não será carregado")}}catch(Z){console.warn("[Recibo] Exceção ao montar perfil/logo:",(Z==null?void 0:Z.message)||Z)}const tt={nome_exibicao:(O==null?void 0:O.nome_exibicao)||"Zelo PDV",documento:(O==null?void 0:O.documento)||null,contato:(O==null?void 0:O.contato)||null,endereco:(O==null?void 0:O.endereco)||null,largura_bobina:Xe,logoUrl:Me},ot={idVenda:f,formaPagamento:E,total:U,valorRecebido:$,troco:ae,itens:ge};console.log("[Recibo] normalizado:",{estabelecimento:tt,venda:ot});const De=$t({estabelecimento:tt,venda:ot});let D=ee;if((!D||D.closed)&&(D=window.open("","_blank",`width=${Xe==="58mm"?"280":"380"},height=700`)),!D){console.warn("[Recibo] não foi possível abrir janela de impressão"),console.groupEnd();return}try{D.focus();try{D.postMessage({type:"RECIBO_HTML",html:De},"*")}catch(Z){console.warn("[Recibo] postMessage falhou (seguirá com write/Blob):",(Z==null?void 0:Z.message)||Z)}try{D.document.open(),D.document.write(De),D.document.close()}catch(Z){console.warn("[Recibo] write falhou, tentando via Blob URL:",(Z==null?void 0:Z.message)||Z);const oe=new Blob([De],{type:"text/html"}),M=URL.createObjectURL(oe);D.location.replace(M),setTimeout(()=>URL.revokeObjectURL(M),5e3)}setTimeout(()=>{var Z;try{if(!!D&&!D.closed&&D.document&&/Preparando\s+recibo/i.test(((Z=D.document.body)==null?void 0:Z.innerText)||"")){console.warn("[Recibo] placeholder ainda presente; aplicando fallback Blob URL");const M=new Blob([De],{type:"text/html"}),ue=URL.createObjectURL(M);D.location.replace(ue),setTimeout(()=>URL.revokeObjectURL(ue),5e3)}}catch(oe){console.warn("[Recibo] verificação placeholder falhou:",(oe==null?void 0:oe.message)||oe)}},150)}catch(Z){console.warn("[Recibo] Falha ao escrever recibo na janela:",(Z==null?void 0:Z.message)||Z)}finally{console.groupEnd()}}async function se({idMov:f,idCaixa:E,tipo:U,valor:$,motivo:ae,created_at:ge}){var Z,oe;let ee=null,O=null,Me="80mm";try{const{data:M}=await be.auth.getUser(),ue=((Z=M==null?void 0:M.user)==null?void 0:Z.id)||null;if(ue){const{data:Ke}=await be.from("empresa_perfil").select("*").eq("user_id",ue).limit(1).single();if(ee=Ke||null,Me=(ee==null?void 0:ee.largura_bobina)||"80mm",ee!=null&&ee.logo_url)O=ee.logo_url;else if(ue){const bt=be.storage.from("logos").getPublicUrl(`${ue}.png`);O=((oe=bt==null?void 0:bt.data)==null?void 0:oe.publicUrl)||null}}}catch{}const Xe=(ee==null?void 0:ee.nome_exibicao)||"Zelo PDV",st=(ee==null?void 0:ee.documento)||"",tt=(ee==null?void 0:ee.contato)||"",ot=(ee==null?void 0:ee.endereco)||"",D=(ge?new Date(ge):new Date).toLocaleString(),ce=U==="saida"?"Sangria de Caixa":"Suprimento de Caixa",at=U==="saida"?"Valor retirado":"Valor adicionado",it=`<!DOCTYPE html><html><head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>${ce}</title>
    </head><body style="font-family:sans-serif;padding:8px;font-size:12px;width:${Me};">
      ${O?`<img src="${O}" alt="logo" style="max-width:100%;max-height:60px;display:block;margin:0 auto 6px auto;"/>`:""}
      <div style="text-align:center;">
        <div style="font-size:14px;font-weight:700;">${Xe}</div>
        ${st?`<div style="color:#555">${st}</div>`:""}
        ${tt?`<div style="color:#555">${tt}</div>`:""}
        ${ot?`<div style="color:#555">${ot}</div>`:""}
      </div>
      <div style="border-top:1px dashed #999;margin:8px 0"></div>
      <div style="text-align:center;"><strong>${ce}</strong></div>
      <div>Movimentação: #${f??"-"} | Caixa: #${E??"-"}</div>
      <div>Data/Hora: ${D}</div>
      ${ae?`<div>Motivo: ${ae}</div>`:""}
      <div style="border-top:1px dashed #999;margin:8px 0"></div>
      <div style="font-size:14px;font-weight:700">${at}: R$ ${Number($).toFixed(2)}</div>
      <div style="border-top:1px dashed #999;margin:8px 0"></div>
      <div style="text-align:center;color:#555;">Obrigado</div>
      <script>window.onload=function(){setTimeout(()=>{try{window.print()}catch(e){}},100)}<\/script>
    </body></html>`;let We=window.open("","_blank",`width=${Me==="58mm"?"280":"380"},height=600`);if(We)try{We.document.open(),We.document.write(it),We.document.close()}catch{const ue=new Blob([it],{type:"text/html"}),Ke=URL.createObjectURL(ue);We.location.replace(Ke),setTimeout(()=>URL.revokeObjectURL(Ke),5e3)}}const ie=f=>e(0,u=f.id),de=f=>Ve(f),xe=()=>e(10,q=!0),Ge=f=>Ce(f.id),ve=f=>ke(f.id);function Ee(){me=lt(this.value),e(26,me)}function ze(){c=lt(this.value),e(9,c)}const et=()=>{e(7,h=!1),e(8,b=null),e(9,c=1)},rt=f=>{f.key==="Escape"&&(e(7,h=!1),e(8,b=null),e(9,c=1))},He=()=>{e(7,h=!1),e(8,b=null),e(9,c=1)};function Be(){R=this.value,e(12,R)}function ct(){A=lt(this.value),e(11,A)}const nt=()=>e(10,q=!1),Fe=f=>{(f.key==="Escape"||f.key==="Enter"||f.key===" ")&&e(10,q=!1)},Ne=()=>e(10,q=!1),we=()=>e(2,k="dinheiro"),Te=()=>e(2,k="cartao_debito"),Pe=()=>e(2,k="cartao_credito"),Ue=()=>e(2,k="pix");function _(){L=this.checked,e(16,L)}function H(){x=lt(this.value),e(3,x)}const Je=()=>{e(13,w=!1),e(14,V=!1),e(15,C="")},yt=f=>{(f.key==="Escape"||f.key==="Enter"||f.key===" ")&&(e(13,w=!1),e(14,V=!1),e(15,C=""))},wt=()=>{e(13,w=!1),e(14,V=!1),e(15,C="")},dt=()=>e(18,te="entrada"),mt=()=>e(18,te="saida");function kt(){F=lt(this.value),e(19,F)}function ut(){W=this.value,e(20,W)}function Ct(){j=this.checked,e(21,j)}const pt=()=>{e(17,P=!1),e(22,Q=!1),e(23,B="")},ht=f=>{f.key==="Escape"&&(e(17,P=!1),e(22,Q=!1),e(23,B=""))},xt=()=>{e(17,P=!1),e(22,Q=!1),e(23,B="")};return l.$$.update=()=>{l.$$.dirty[0]&1|l.$$.dirty[1]&4096&&e(30,r=n.filter(f=>f.id_categoria===u)),l.$$.dirty[0]&2&&e(4,m=v.reduce((f,E)=>f+E.preco*E.quantidade,0)),l.$$.dirty[0]&28&&e(29,y=k==="dinheiro"?Math.max(0,Number(x)-Number(m)):0)},[u,v,k,x,m,p,N,h,b,c,q,A,R,w,V,C,L,P,te,F,W,j,Q,B,S,z,me,X,je,y,r,Ie,Ve,ke,Ce,Ae,qe,Se,pe,Y,he,Re,_e,n,ie,de,xe,Ge,ve,Ee,ze,et,rt,He,Be,ct,nt,Fe,Ne,we,Te,Pe,Ue,_,H,Je,yt,wt,dt,mt,kt,ut,Ct,pt,ht,xt]}class po extends Jt{constructor(t){super(),Wt(this,t,so,no,Zt,{},null,[-1,-1,-1])}}export{po as component};
