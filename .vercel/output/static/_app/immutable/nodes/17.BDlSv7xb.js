import{s as dt,n as Ke,c as ft,o as mt,r as bt,e as st,d as _t}from"../chunks/DUJQqtHE.js";import{S as ht,i as vt,d,a as M,o as s,c as o,p as P,g as _,n as ot,h as r,j as h,s as it,b as t,e as E,f as ut,t as ct,w as gt,u as A,y as rt,v as y,z as Ct}from"../chunks/CBbGAyDJ.js";import{s as re}from"../chunks/BxpIoVra.js";import{p as xt}from"../chunks/D5Jx8Owt.js";function Et({nome_exibicao:l,documento:a,contato:e,largura_bobina:i}){const f=(l||"").trim(),b=(a||"").trim(),u=(e||"").trim(),v=i||"";return!!(f&&b&&u&&(v==="58mm"||v==="80mm"))}function yt({userId:l,nome_exibicao:a,documento:e,contato:i,inscricao_estadual:f,endereco:b,rodape_recibo:u,largura_bobina:v,logo_url:c,pendingLogoUrl:p}){return{user_id:l,nome_exibicao:(a||"").trim(),documento:(e||"").trim(),contato:(i||"").trim(),inscricao_estadual:(f||"").trim()||null,endereco:(b||"").trim()||null,rodape_recibo:(u||"Obrigado pela preferência!").trim()||"Obrigado pela preferência!",largura_bobina:v,logo_url:p||c||null,updated_at:new Date().toISOString()}}function kt(l,{maxBytes:a=1.5*1024*1024}={}){if(!l)return!1;const e=typeof l.type=="string"?l.type.startsWith("image/"):!0,i=typeof l.size=="number"?l.size<=a:!0;return!!(e&&i)}function nt(l){let a,e;return{c(){a=r("div"),e=ct(l[2]),this.h()},l(i){a=o(i,"DIV",{class:!0});var f=E(a);e=ut(f,l[2]),f.forEach(d),this.h()},h(){s(a,"class","mb-4 text-sm text-amber-400")},m(i,f){M(i,a,f),t(a,e)},p(i,f){f&4&&it(e,i[2])},d(i){i&&d(a)}}}function wt(l){let a,e,i="Voltar ao App",f,b,u="Sair",v,c,p,n,C="Nome exibido no recibo *",j,k,Z,N,O,T,pe="Documento (CNPJ/CPF) *",de,B,be,q,R,Ce="Contato (telefone ou e-mail) *",_e,D,he,V,z,F,U="Inscrição Estadual (opcional)",g,w,G,S,H,fe="Largura da bobina *",ve,I,J,Qe="80 mm",W,Ye="58 mm",qe,$,ne,Ze="Endereço (opcional)",Ve,X,ze,ee,ie,$e="Logo da empresa (opcional)",Me,te,K,xe,je,le,me,Re,ue,et="PNG quadrado até ~1MB recomendado",Fe,ae,ce,tt="Rodapé do recibo (opcional)",Ge,Q,He,se,Y,ge=l[1]?"Salvando…":"Salvar alterações",Ee,ye,Je,pt=!l[11](),We,lt,oe=pt&&Nt();return{c(){a=r("div"),e=r("a"),e.textContent=i,f=h(),b=r("button"),b.textContent=u,v=h(),c=r("form"),p=r("label"),n=r("span"),n.textContent=C,j=h(),k=r("input"),Z=h(),N=r("div"),O=r("label"),T=r("span"),T.textContent=pe,de=h(),B=r("input"),be=h(),q=r("label"),R=r("span"),R.textContent=Ce,_e=h(),D=r("input"),he=h(),V=r("div"),z=r("label"),F=r("span"),F.textContent=U,g=h(),w=r("input"),G=h(),S=r("label"),H=r("span"),H.textContent=fe,ve=h(),I=r("select"),J=r("option"),J.textContent=Qe,W=r("option"),W.textContent=Ye,qe=h(),$=r("label"),ne=r("span"),ne.textContent=Ze,Ve=h(),X=r("input"),ze=h(),ee=r("div"),ie=r("span"),ie.textContent=$e,Me=h(),te=r("div"),K=r("img"),je=h(),le=r("div"),me=r("input"),Re=h(),ue=r("span"),ue.textContent=et,Fe=h(),ae=r("label"),ce=r("span"),ce.textContent=tt,Ge=h(),Q=r("textarea"),He=h(),se=r("div"),Y=r("button"),Ee=ct(ge),Je=h(),oe&&oe.c(),this.h()},l(m){a=o(m,"DIV",{class:!0});var x=E(a);e=o(x,"A",{href:!0,class:!0,"data-svelte-h":!0}),P(e)!=="svelte-1a6dxf3"&&(e.textContent=i),f=_(x),b=o(x,"BUTTON",{class:!0,"data-svelte-h":!0}),P(b)!=="svelte-thug41"&&(b.textContent=u),x.forEach(d),v=_(m),c=o(m,"FORM",{class:!0});var L=E(c);p=o(L,"LABEL",{class:!0});var ke=E(p);n=o(ke,"SPAN",{class:!0,"data-svelte-h":!0}),P(n)!=="svelte-1qkl3ff"&&(n.textContent=C),j=_(ke),k=o(ke,"INPUT",{class:!0}),ke.forEach(d),Z=_(L),N=o(L,"DIV",{class:!0});var we=E(N);O=o(we,"LABEL",{class:!0});var Pe=E(O);T=o(Pe,"SPAN",{class:!0,"data-svelte-h":!0}),P(T)!=="svelte-1ya14v5"&&(T.textContent=pe),de=_(Pe),B=o(Pe,"INPUT",{class:!0}),Pe.forEach(d),be=_(we),q=o(we,"LABEL",{class:!0});var Ne=E(q);R=o(Ne,"SPAN",{class:!0,"data-svelte-h":!0}),P(R)!=="svelte-17j2cwh"&&(R.textContent=Ce),_e=_(Ne),D=o(Ne,"INPUT",{class:!0}),Ne.forEach(d),we.forEach(d),he=_(L),V=o(L,"DIV",{class:!0});var Se=E(V);z=o(Se,"LABEL",{class:!0});var Le=E(z);F=o(Le,"SPAN",{class:!0,"data-svelte-h":!0}),P(F)!=="svelte-1ahl419"&&(F.textContent=U),g=_(Le),w=o(Le,"INPUT",{class:!0,placeholder:!0}),Le.forEach(d),G=_(Se),S=o(Se,"LABEL",{class:!0});var Ae=E(S);H=o(Ae,"SPAN",{class:!0,"data-svelte-h":!0}),P(H)!=="svelte-z1lxc5"&&(H.textContent=fe),ve=_(Ae),I=o(Ae,"SELECT",{class:!0});var Xe=E(I);J=o(Xe,"OPTION",{"data-svelte-h":!0}),P(J)!=="svelte-1fm26xo"&&(J.textContent=Qe),W=o(Xe,"OPTION",{"data-svelte-h":!0}),P(W)!=="svelte-1i7d6cc"&&(W.textContent=Ye),Xe.forEach(d),Ae.forEach(d),Se.forEach(d),qe=_(L),$=o(L,"LABEL",{class:!0});var Ie=E($);ne=o(Ie,"SPAN",{class:!0,"data-svelte-h":!0}),P(ne)!=="svelte-1qg1gjg"&&(ne.textContent=Ze),Ve=_(Ie),X=o(Ie,"INPUT",{class:!0}),Ie.forEach(d),ze=_(L),ee=o(L,"DIV",{class:!0});var Oe=E(ee);ie=o(Oe,"SPAN",{class:!0,"data-svelte-h":!0}),P(ie)!=="svelte-1ycplzh"&&(ie.textContent=$e),Me=_(Oe),te=o(Oe,"DIV",{class:!0});var Te=E(te);K=o(Te,"IMG",{src:!0,alt:!0,class:!0}),je=_(Te),le=o(Te,"DIV",{class:!0});var Be=E(le);me=o(Be,"INPUT",{type:!0,accept:!0}),Re=_(Be),ue=o(Be,"SPAN",{class:!0,"data-svelte-h":!0}),P(ue)!=="svelte-1gml9ob"&&(ue.textContent=et),Be.forEach(d),Te.forEach(d),Oe.forEach(d),Fe=_(L),ae=o(L,"LABEL",{class:!0});var De=E(ae);ce=o(De,"SPAN",{class:!0,"data-svelte-h":!0}),P(ce)!=="svelte-mnowwv"&&(ce.textContent=tt),Ge=_(De),Q=o(De,"TEXTAREA",{class:!0}),E(Q).forEach(d),De.forEach(d),He=_(L),se=o(L,"DIV",{class:!0});var Ue=E(se);Y=o(Ue,"BUTTON",{type:!0,class:!0});var at=E(Y);Ee=ut(at,ge),at.forEach(d),Je=_(Ue),oe&&oe.l(Ue),Ue.forEach(d),L.forEach(d),this.h()},h(){s(e,"href","/app"),s(e,"class","px-3 py-1.5 rounded-md border border-slate-700 text-slate-200 hover:bg-slate-800"),s(b,"class","px-3 py-1.5 rounded-md border border-slate-700 text-slate-200 hover:bg-slate-800"),s(a,"class","flex items-center gap-2 mb-4"),s(n,"class","block mb-1"),s(k,"class","w-full rounded-md border border-slate-700 bg-slate-900 px-3 py-2"),s(p,"class","block"),s(T,"class","block mb-1"),s(B,"class","w-full rounded-md border border-slate-700 bg-slate-900 px-3 py-2"),s(O,"class","block"),s(R,"class","block mb-1"),s(D,"class","w-full rounded-md border border-slate-700 bg-slate-900 px-3 py-2"),s(q,"class","block"),s(N,"class","grid sm:grid-cols-2 gap-4"),s(F,"class","block mb-1"),s(w,"class","w-full rounded-md border border-slate-700 bg-slate-900 px-3 py-2"),s(w,"placeholder","ISENTO quando aplicável"),s(z,"class","block"),s(H,"class","block mb-1"),J.__value="80mm",A(J,J.__value),W.__value="58mm",A(W,W.__value),s(I,"class","w-full rounded-md border border-slate-700 bg-slate-900 px-3 py-2"),l[8]===void 0&&_t(()=>l[20].call(I)),s(S,"class","block"),s(V,"class","grid sm:grid-cols-2 gap-4"),s(ne,"class","block mb-1"),s(X,"class","w-full rounded-md border border-slate-700 bg-slate-900 px-3 py-2"),s($,"class","block"),s(ie,"class","block"),st(K.src,xe=l[9])||s(K,"src",xe),s(K,"alt","Logo"),s(K,"class","w-20 h-20 rounded border border-slate-700 object-contain bg-slate-900"),s(me,"type","file"),s(me,"accept","image/*"),s(ue,"class","text-xs text-slate-400"),s(le,"class","flex flex-col gap-1"),s(te,"class","flex items-center gap-4"),s(ee,"class","grid gap-3"),s(ce,"class","block mb-1"),s(Q,"class","w-full rounded-md border border-slate-700 bg-slate-900 px-3 py-2 min-h-[80px]"),s(ae,"class","block"),s(Y,"type","submit"),s(Y,"class","px-4 py-2 rounded-md bg-sky-600 hover:bg-sky-700 text-white font-semibold disabled:opacity-60"),Y.disabled=ye=!l[11]()||l[1],s(se,"class","flex items-center gap-3"),s(c,"class","bg-slate-900/50 border border-slate-700 rounded-xl p-4 grid gap-4 max-w-2xl")},m(m,x){M(m,a,x),t(a,e),t(a,f),t(a,b),M(m,v,x),M(m,c,x),t(c,p),t(p,n),t(p,j),t(p,k),A(k,l[3]),t(c,Z),t(c,N),t(N,O),t(O,T),t(O,de),t(O,B),A(B,l[4]),t(N,be),t(N,q),t(q,R),t(q,_e),t(q,D),A(D,l[5]),t(c,he),t(c,V),t(V,z),t(z,F),t(z,g),t(z,w),A(w,l[6]),t(V,G),t(V,S),t(S,H),t(S,ve),t(S,I),t(I,J),t(I,W),rt(I,l[8],!0),t(c,qe),t(c,$),t($,ne),t($,Ve),t($,X),A(X,l[7]),t(c,ze),t(c,ee),t(ee,ie),t(ee,Me),t(ee,te),t(te,K),t(te,je),t(te,le),t(le,me),t(le,Re),t(le,ue),t(c,Fe),t(c,ae),t(ae,ce),t(ae,Ge),t(ae,Q),A(Q,l[10]),t(c,He),t(c,se),t(se,Y),t(Y,Ee),t(se,Je),oe&&oe.m(se,null),We||(lt=[y(b,"click",l[15]),y(k,"input",l[16]),y(k,"input",l[12]),y(B,"input",l[17]),y(B,"input",l[12]),y(D,"input",l[18]),y(D,"input",l[12]),y(w,"input",l[19]),y(w,"input",l[12]),y(I,"change",l[20]),y(I,"change",l[12]),y(X,"input",l[21]),y(X,"input",l[12]),y(me,"change",l[13]),y(Q,"input",l[22]),y(Q,"input",l[12]),y(c,"submit",Ct(l[14]))],We=!0)},p(m,x){x&8&&k.value!==m[3]&&A(k,m[3]),x&16&&B.value!==m[4]&&A(B,m[4]),x&32&&D.value!==m[5]&&A(D,m[5]),x&64&&w.value!==m[6]&&A(w,m[6]),x&256&&rt(I,m[8]),x&128&&X.value!==m[7]&&A(X,m[7]),x&512&&!st(K.src,xe=m[9])&&s(K,"src",xe),x&1024&&A(Q,m[10]),x&2&&ge!==(ge=m[1]?"Salvando…":"Salvar alterações")&&it(Ee,ge),x&2&&ye!==(ye=!m[11]()||m[1])&&(Y.disabled=ye)},d(m){m&&(d(a),d(v),d(c)),oe&&oe.d(),We=!1,bt(lt)}}}function Pt(l){let a,e="Carregando…";return{c(){a=r("p"),a.textContent=e},l(i){a=o(i,"P",{"data-svelte-h":!0}),P(a)!=="svelte-11l7wgg"&&(a.textContent=e)},m(i,f){M(i,a,f)},p:Ke,d(i){i&&d(a)}}}function Nt(l){let a,e="Preencha os campos obrigatórios marcados com *";return{c(){a=r("span"),a.textContent=e,this.h()},l(i){a=o(i,"SPAN",{class:!0,"data-svelte-h":!0}),P(a)!=="svelte-1aviip"&&(a.textContent=e),this.h()},h(){s(a,"class","text-sm text-amber-400")},m(i,f){M(i,a,f)},d(i){i&&d(a)}}}function St(l){let a,e="Perfil da Empresa",i,f,b,u=l[2]&&nt(l);function v(n,C){return n[0]?Pt:wt}let c=v(l),p=c(l);return{c(){a=r("h1"),a.textContent=e,i=h(),u&&u.c(),f=h(),p.c(),b=ot(),this.h()},l(n){a=o(n,"H1",{class:!0,"data-svelte-h":!0}),P(a)!=="svelte-1mda21k"&&(a.textContent=e),i=_(n),u&&u.l(n),f=_(n),p.l(n),b=ot(),this.h()},h(){s(a,"class","text-2xl font-semibold mb-2")},m(n,C){M(n,a,C),M(n,i,C),u&&u.m(n,C),M(n,f,C),p.m(n,C),M(n,b,C)},p(n,[C]){n[2]?u?u.p(n,C):(u=nt(n),u.c(),u.m(f.parentNode,f)):u&&(u.d(1),u=null),c===(c=v(n))&&p?p.p(n,C):(p.d(1),p=c(n),p&&(p.c(),p.m(b.parentNode,b)))},i:Ke,o:Ke,d(n){n&&(d(a),d(i),d(f),d(b)),u&&u.d(n),p.d(n)}}}function Lt(l,a,e){let i;ft(l,xt,U=>e(26,i=U));let f=!0,b=!1,u="",v=null,c="",p="",n="",C="",j="",k="80mm",Z="",N="Obrigado pela preferência!",O=null;const T=()=>Et({nome_exibicao:c,documento:p,contato:n,largura_bobina:k});let pe=!1;function de(){pe=!0}function B(){pe=!1}mt(async()=>{const{data:{session:U}}=await re.auth.getSession();if(!U){window.location.href="/login";return}v=U.user.id;const{data:g,error:w}=await re.from("empresa_perfil").select("*").eq("user_id",v).maybeSingle();w?(console.error("Erro ao carregar perfil",w),e(2,u="Erro ao carregar perfil.")):g&&(e(3,c=g.nome_exibicao??""),e(4,p=g.documento??""),e(5,n=g.contato??""),e(6,C=g.inscricao_estadual??""),e(7,j=g.endereco??""),e(8,k=g.largura_bobina??"80mm"),e(9,Z=g.logo_url??""),e(10,N=g.rodape_recibo??"Obrigado pela preferência!")),new URLSearchParams(i.url.search).get("msg")==="complete"&&!T()&&e(2,u="Complete as informações da sua empresa antes de continuar."),e(0,f=!1),typeof window<"u"&&window.addEventListener("beforeunload",S=>{pe&&(S.preventDefault(),S.returnValue="")})});async function be(U){var w;const g=(w=U.target.files)==null?void 0:w[0];if(!(!g||!v))try{if(!kt(g)){e(2,u="Arquivo inválido. Envie uma imagem (até ~1.5MB).");return}const G=`${v}.png`,{error:S}=await re.storage.from("logos").upload(G,g,{upsert:!0,contentType:g.type||"image/png"});if(S)throw S;const{data:H}=re.storage.from("logos").getPublicUrl(G),fe=H.publicUrl;e(9,Z=fe);const{data:ve}=await re.from("empresa_perfil").select("user_id").eq("user_id",v).maybeSingle();ve?await re.from("empresa_perfil").upsert({user_id:v,logo_url:fe},{onConflict:"user_id"}):O=fe,e(2,u="Logo atualizada."),de()}catch(G){console.error(G),e(2,u="Erro ao enviar logo.")}}async function q(){if(!T()){e(2,u="Preencha os campos obrigatórios.");return}e(1,b=!0),e(2,u="");const U=yt({userId:v,nome_exibicao:c,documento:p,contato:n,inscricao_estadual:C,endereco:j,rodape_recibo:N,largura_bobina:k,logo_url:Z,pendingLogoUrl:O}),{error:g}=await re.from("empresa_perfil").upsert(U,{onConflict:"user_id"});if(e(1,b=!1),g){e(2,u="Erro ao salvar perfil.");return}e(2,u="Perfil salvo com sucesso."),B(),setTimeout(()=>{window.location.href="/painel.html"},600)}async function R(){try{await re.auth.signOut()}catch{}window.location.href="/login"}function Ce(){c=this.value,e(3,c)}function _e(){p=this.value,e(4,p)}function D(){n=this.value,e(5,n)}function he(){C=this.value,e(6,C)}function V(){k=gt(this),e(8,k)}function z(){j=this.value,e(7,j)}function F(){N=this.value,e(10,N)}return[f,b,u,c,p,n,C,j,k,Z,N,T,de,be,q,R,Ce,_e,D,he,V,z,F]}class Bt extends ht{constructor(a){super(),vt(this,a,Lt,St,dt,{})}}export{Bt as component};
