import{s as O,n as U,e as q,o as V}from"../chunks/DUJQqtHE.js";import{S as H,i as J,d as u,b as E,a as h,o as v,A as M,c as b,p as P,g as k,e as T,h as y,j as I,v as Y,f as B,t as g,s as N,n as L,B as w}from"../chunks/CBbGAyDJ.js";import{s as R}from"../chunks/BxpIoVra.js";import"../chunks/qixkw80f.js";function z(f){let t,a=(f[1]||"Para usar o sistema, ative sua assinatura.")+"",l,s,r;function _(e,i){return e[3]&&e[4]?j:K}let n=_(f)(f);return{c(){t=y("div"),l=g(a),s=I(),n.c(),r=L(),this.h()},l(e){t=b(e,"DIV",{class:!0});var i=T(t);l=B(i,a),i.forEach(u),s=k(e),n.l(e),r=L(),this.h()},h(){v(t,"class","p-3 bg-amber-50 text-amber-800 rounded")},m(e,i){h(e,t,i),E(t,l),h(e,s,i),n.m(e,i),h(e,r,i)},p(e,i){i&2&&a!==(a=(e[1]||"Para usar o sistema, ative sua assinatura.")+"")&&N(l,a),n.p(e,i)},d(e){e&&(u(t),u(s),u(r)),n.d(e)}}}function D(f){let t,a="Assinatura ativa.",l,s,r,_,d;return{c(){t=y("div"),t.textContent=a,l=I(),s=y("button"),r=g("Gerenciar assinatura"),this.h()},l(n){t=b(n,"DIV",{class:!0,"data-svelte-h":!0}),P(t)!=="svelte-bn79bq"&&(t.textContent=a),l=k(n),s=b(n,"BUTTON",{class:!0});var e=T(s);r=B(e,"Gerenciar assinatura"),e.forEach(u),this.h()},h(){v(t,"class","p-3 bg-green-50 text-green-700 rounded"),v(s,"class","btn-secondary"),s.disabled=f[0]},m(n,e){h(n,t,e),h(n,l,e),h(n,s,e),E(s,r),_||(d=Y(s,"click",f[6]),_=!0)},p(n,e){e&1&&(s.disabled=n[0])},d(n){n&&(u(t),u(l),u(s)),_=!1,d()}}}function K(f){let t,a=f[0]?"Redirecionando…":"Assinar R$ 59/mês",l,s,r,_="Dica: defina VITE_PUBLIC_STRIPE_BUY_BUTTON_ID e VITE_PUBLIC_STRIPE_PUBLISHABLE_KEY no .env para exibir o botão do Stripe embutido.",d,n;return{c(){t=y("button"),l=g(a),s=I(),r=y("div"),r.textContent=_,this.h()},l(e){t=b(e,"BUTTON",{class:!0});var i=T(t);l=B(i,a),i.forEach(u),s=k(e),r=b(e,"DIV",{class:!0,"data-svelte-h":!0}),P(r)!=="svelte-g0q6io"&&(r.textContent=_),this.h()},h(){v(t,"class","btn-primary"),t.disabled=f[0],v(r,"class","text-xs text-slate-500 mt-2")},m(e,i){h(e,t,i),E(t,l),h(e,s,i),h(e,r,i),d||(n=Y(t,"click",f[5]),d=!0)},p(e,i){i&1&&a!==(a=e[0]?"Redirecionando…":"Assinar R$ 59/mês")&&N(l,a),i&1&&(t.disabled=e[0])},d(e){e&&(u(t),u(s),u(r)),d=!1,n()}}}function j(f){let t,a;return{c(){t=y("div"),a=y("stripe-buy-button"),this.h()},l(l){t=b(l,"DIV",{class:!0});var s=T(t);a=b(s,"STRIPE-BUY-BUTTON",{"buy-button-id":!0,"publishable-key":!0}),T(a).forEach(u),s.forEach(u),this.h()},h(){w(a,"buy-button-id",f[3]),w(a,"publishable-key",f[4]),v(t,"class","mt-2")},m(l,s){h(l,t,s),E(t,a)},p:U,d(l){l&&u(t)}}}function F(f){let t,a="",l,s,r,_,d="Assinatura Zelo PDV",n,e,i="R$ 59/mês — cancele quando quiser.",x;function S(p,m){return p[2]==="active"||p[2]==="trialing"?D:z}let c=S(f),o=c(f);return{c(){t=y("script"),t.innerHTML=a,s=I(),r=y("section"),_=y("h1"),_.textContent=d,n=I(),e=y("p"),e.textContent=i,x=I(),o.c(),this.h()},l(p){const m=M("svelte-132of7h",document.head);t=b(m,"SCRIPT",{src:!0,"data-svelte-h":!0}),P(t)!=="svelte-1qpprr0"&&(t.innerHTML=a),m.forEach(u),s=k(p),r=b(p,"SECTION",{class:!0});var C=T(r);_=b(C,"H1",{class:!0,"data-svelte-h":!0}),P(_)!=="svelte-148nn2t"&&(_.textContent=d),n=k(C),e=b(C,"P",{class:!0,"data-svelte-h":!0}),P(e)!=="svelte-cdhlm3"&&(e.textContent=i),x=k(C),o.l(C),C.forEach(u),this.h()},h(){t.async=!0,q(t.src,l="https://js.stripe.com/v3/buy-button.js")||v(t,"src",l),v(_,"class","text-2xl font-bold"),v(e,"class","text-slate-600 dark:text-slate-300"),v(r,"class","max-w-xl mx-auto space-y-4")},m(p,m){E(document.head,t),h(p,s,m),h(p,r,m),E(r,_),E(r,n),E(r,e),E(r,x),o.m(r,null)},p(p,[m]){c===(c=S(p))&&o?o.p(p,m):(o.d(1),o=c(p),o&&(o.c(),o.m(r,null)))},i:U,o:U,d(p){p&&(u(s),u(r)),u(t),o.d()}}}let A=null;function G(f,t,a){let l=!1,s="",r=null,_="",d="";V(async()=>{var o,p;const{data:c}=await R.auth.getUser();if(d=((o=c==null?void 0:c.user)==null?void 0:o.id)||"",_=((p=c==null?void 0:c.user)==null?void 0:p.email)||"",d){const{data:m}=await R.from("subscriptions").select("status").eq("user_id",d).maybeSingle();a(2,r=(m==null?void 0:m.status)||null)}try{const C=new URLSearchParams(window.location.search).get("msg");C==="subscribe"?a(1,s="Sua assinatura não está ativa. Assine para utilizar o sistema."):C==="complete"&&a(1,s="Complete o perfil da empresa para continuar.")}catch{}});const n="https://buy.stripe.com/test_bJeaEYaht4mV5zC8pJ00000",e="",i="pk_live_51RxYCmLUJWyE4PkYzYnJstmaICs14Lcmz8kSerkExOzCOdfdhH8m5gZuf65KUJMLAHcq9R7kh2VYeApsMLPtdIkU00u3IFh6E6";async function x(){try{if(a(0,l=!0),a(1,s=""),n){window.location.href=n;return}}catch(c){a(1,s=(c==null?void 0:c.message)||"Erro.")}finally{a(0,l=!1)}}async function S(){try{if(a(0,l=!0),a(1,s=""),!A){a(1,s="Nenhum cliente Stripe vinculado.");return}const o=await(await fetch("/api/billing/create-portal-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:A})})).json();if(o!=null&&o.url){window.location.href=o.url;return}a(1,s=(o==null?void 0:o.error)||"Falha ao abrir portal.")}catch(c){a(1,s=(c==null?void 0:c.message)||"Erro.")}finally{a(0,l=!1)}}return[l,s,r,e,i,x,S]}class $ extends H{constructor(t){super(),J(this,t,G,F,O,{})}}export{$ as component};
