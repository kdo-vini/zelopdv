import{s as n}from"./BxpIoVra.js";async function p({requireProfile:m=!1,redirectOnFail:t=!0}={}){var r,s,u,l;const{data:i}=await n.auth.getSession(),a=((s=(r=i==null?void 0:i.session)==null?void 0:r.user)==null?void 0:s.id)||null,o=((l=(u=i==null?void 0:i.session)==null?void 0:u.user)==null?void 0:l.email)||null;if(!a)return t&&(window.location.href="/login"),null;if(m)try{const{data:e}=await n.from("empresa_perfil").select("nome_exibicao, documento, contato, largura_bobina").eq("user_id",a).maybeSingle();if(!!!(e&&e.nome_exibicao&&e.documento&&e.contato&&(e.largura_bobina==="58mm"||e.largura_bobina==="80mm")))return t&&(window.location.href="/perfil?msg=complete"),null}catch{}try{let{data:e}=await n.from("subscriptions").select("status, current_period_end, user_email, user_id").eq("user_id",a).maybeSingle();if(!e&&o){const{data:f}=await n.from("subscriptions").select("id, status, current_period_end, user_email, user_id").eq("user_email",o).maybeSingle();e=f||null}const c=new Date,d=e!=null&&e.current_period_end?new Date(e.current_period_end)>c:!1;if(!(e&&(e.status==="active"||e.status==="trialing"&&d)))return t&&(window.location.href="/assinatura?msg=subscribe"),null}catch{return t&&(window.location.href="/assinatura?msg=subscribe"),null}return{userId:a,email:o}}export{p as e};
